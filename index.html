<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tati Manicure - Gerenciamento de Agendamentos</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff6b8b; /* Rosa mais feminino */
            --secondary-color: #ba68c8; /* Roxo suave */
            --background-color: #fce4ec; /* Rosa claro de fundo */
            --sidebar-bg: #ffffff;
            --sidebar-hover-bg: #f8bbd9; /* Rosa mais claro para hover */
            --text-color: #4a148c; /* Roxo escuro para texto */
            --success-color: #66bb6a; /* Verde suave */
            --info-color: #4fc3f7; /* Azul claro */
            --danger-color: #ef5350; /* Vermelho suave */
            --warning-color: #ffb74d; /* Laranja suave */
            --border-color: #f48fb1; /* Rosa para bordas */
            --shadow-color: rgba(255, 107, 139, 0.1); /* Sombra rosa */
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); /* Gradiente feminino */
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
        }

        /* Estrutura do App */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            background: linear-gradient(135deg, #ff6b8b 0%, #ba68c8 100%); /* Gradiente rosa-roxo */
            min-height: 100vh;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23ffffff" opacity="0.1" d="M30,30 Q50,10 70,30 T90,50 Q70,90 50,70 T10,50 Q30,10 50,30 Z M40,40 Q50,35 60,40 T70,50 Q60,65 50,60 T30,50 Q40,35 50,40 Z"/></svg>');
            background-size: 150px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 107, 139, 0.3);
            text-align: center;
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-card h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 1.8rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .login-icon {
            font-size: 80px;
            color: var(--primary-color);
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        #app-container {
            display: none;
            width: 100%;
            flex-direction: row;
        }

        /* Barra Lateral (Sidebar) */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            box-shadow: 4px 0 15px var(--shadow-color);
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            flex-shrink: 0;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            font-size: 1.6rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            padding: 0 20px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            font-weight: 500;
            border-left: 4px solid transparent;
        }

        .sidebar ul li a:hover,
        .sidebar ul li a.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-left-color: white;
            transform: translateX(5px);
        }

        .sidebar ul li a .material-icons {
            margin-right: 10px;
            font-size: 20px;
        }

        .user-info {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .user-info p {
            margin: 0 0 10px 0;
            font-weight: bold;
            color: white;
        }

        /* Conteúdo Principal */
        .main-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
            background: var(--background-color);
        }

        .content-section {
            display: none;
            padding: 20px;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .section-header h2 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.5rem;
        }
        
        /* Novas cores para Status de Pacote e Histórico */
        .status-package-paid {
             color: var(--success-color);
             font-weight: bold;
        }
        .status-package-pending {
            color: var(--warning-color);
            font-weight: bold;
        }
        .status-package-active {
            color: var(--primary-color);
            font-weight: bold;
        }
        .status-package-finalized {
            color: var(--danger-color);
            font-weight: bold;
        }

        /* Cartão (Card) */
        .card {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px var(--shadow-color);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 107, 139, 0.1);
            backdrop-filter: blur(10px);
        }
        
        /* NOVO V6: Abas dentro de uma seção */
        .tab-menu {
             display: flex;
             border-bottom: 3px solid var(--border-color);
             margin-bottom: 20px;
             border-radius: 10px 10px 0 0;
             overflow: hidden;
        }
        .tab-menu button {
             padding: 12px 20px;
             border: none;
             background: rgba(255, 255, 255, 0.7);
             cursor: pointer;
             font-size: 1rem;
             color: var(--secondary-color);
             border-bottom: 3px solid transparent;
             transition: all 0.3s ease;
             font-weight: bold;
             flex: 1;
        }
        .tab-menu button.active {
             color: var(--primary-color);
             border-bottom: 3px solid var(--primary-color);
             background: white;
        }
        .tab-menu button:hover {
             background: rgba(255, 255, 255, 0.9);
             color: var(--primary-color);
        }
        .tab-content {
             padding-top: 10px;
        }
        .tab-pane {
             display: none;
        }
        .tab-pane.active {
             display: block;
             animation: fadeIn 0.5s ease-in;
        }

        /* Formulários */
        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row > div {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        /* Datalist input */
        input[list] {
            background-image: none;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 139, 0.2);
            background: white;
        }

        textarea {
            resize: vertical;
        }

        /* Botões */
        button, .btn {
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 107, 139, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #4caf50 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(102, 187, 106, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #7b1fa2 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(186, 104, 200, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #d32f2f 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(239, 83, 80, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #f57c00 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 183, 77, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-color) 0%, #0288d1 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 195, 247, 0.4);
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px var(--shadow-color);
        }

        .data-table thead tr {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            text-align: left;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tbody tr:hover {
            background: rgba(255, 107, 139, 0.05);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .data-table td.action-buttons button {
            margin-right: 5px;
            padding: 6px 8px;
        }

        .data-table td.action-buttons {
            white-space: nowrap;
        }

        /* Notificação */
        #notification-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            transform: translateY(-20px);
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        #notification-bar.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        #notification-bar.success { 
            background: linear-gradient(135deg, var(--success-color) 0%, #4caf50 100%); 
        }
        #notification-bar.error { 
            background: linear-gradient(135deg, var(--danger-color) 0%, #d32f2f 100%); 
        }
        #notification-bar.info { 
            background: linear-gradient(135deg, var(--info-color) 0%, #0288d1 100%); 
        }

        /* Utilitários */
        .flex-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input, .input-group select {
            flex-grow: 1;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 20px;
        }
        .filter-row > div {
            flex: 1;
        }
        .filter-row button {
            flex-grow: 0;
            flex-shrink: 0;
            padding: 11px 15px;
        }
        
        /* NOVO V6: Estilos para a Tabela de Visão Diária */
        #tabela-visao-diaria {
             border: 2px solid var(--border-color);
             margin-top: 0;
             border-radius: 10px;
        }
        #tabela-visao-diaria thead tr {
             background: linear-gradient(135deg, var(--secondary-color) 0%, #7b1fa2 100%);
        }
        #tabela-visao-diaria td {
             height: 40px;
             font-size: 0.9rem;
             vertical-align: top;
        }
        .horario-celula {
             width: 80px;
             font-weight: bold;
             background: rgba(255, 107, 139, 0.1);
             color: var(--text-color);
             text-align: center;
             vertical-align: middle !important;
             border-right: 2px solid var(--border-color);
        }
        .agendamento-vago {
             background: rgba(102, 187, 106, 0.1);
             color: var(--success-color);
             font-weight: bold;
             font-style: italic;
             text-align: center;
             line-height: 40px;
        }
        .agendamento-vencido {
             background: rgba(239, 83, 80, 0.1);
             color: var(--danger-color);
             font-weight: bold;
             font-style: italic;
             text-align: center;
             line-height: 40px;
        }
        .agendamento-ocupado {
             background: rgba(255, 107, 139, 0.05);
             color: var(--text-color);
             font-weight: 500;
             padding: 5px 10px !important;
             vertical-align: middle !important;
             line-height: 1.2;
             border-left: 5px solid var(--primary-color);
             cursor: pointer;
        }
        .agendamento-ocupado strong {
             color: var(--primary-color);
             font-weight: bold;
        }
        
        /* Modal para usar pacote */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border-color);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }
        
        /* --------------------------------------------------- */
        /* RESPONSIVIDADE MOBILE - MELHORIAS PARA VISÃO DIÁRIA */
        /* --------------------------------------------------- */
        @media (max-width: 768px) {
            
            /* Estrutura Principal */
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: 0 0 10px var(--shadow-color);
            }

            .main-content {
                padding: 15px;
            }

            #app-container {
                flex-direction: column;
            }

            /* Navegação Horizontal */
            .sidebar ul {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
                border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            }

            .sidebar ul li {
                flex-shrink: 0;
                text-align: center;
            }

            .sidebar ul li a {
                justify-content: center;
                padding: 10px;
                flex-direction: column;
                font-size: 0.75rem;
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .sidebar ul li a:hover,
            .sidebar ul li a.active {
                border-left: none;
                border-bottom: 3px solid white;
                transform: translateY(-2px);
            }

            .sidebar ul li a .material-icons {
                margin-right: 0;
                margin-bottom: 5px;
                font-size: 20px;
            }

            /* FIX: Botão Sair visível no celular */
            .user-info {
                display: block;
                padding: 10px 15px;
                border-top: none; 
                text-align: center; 
            }

            .user-info p {
                display: none;
            }

            .user-info button {
                width: 100%;
                margin-top: 10px; 
                font-size: 0.9rem;
            }
            
            /* 1. Correção de Formulários e Filtros (Empilhamento) */
            .form-row, .filter-row {
                flex-direction: column;
                gap: 0;
            }

            .form-row > div, 
            .filter-row > div {
                flex: 0 0 100% !important;
                width: 100%;
            }
            
            /* Ajusta margem para inputs empilhados */
            .form-group, .filter-row > div {
                margin-bottom: 10px;
            }
            
            .filter-row button {
                width: 100%;
                margin-top: 5px; 
                padding: 12px 15px !important;
            }
            
            /* MELHORIA: Visão Diária em Mobile */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            #tabela-visao-diaria {
                width: 100%;
                min-width: 350px;
                font-size: 0.85rem;
            }
            
            #tabela-visao-diaria td {
                padding: 8px 5px !important;
                height: 35px;
                word-wrap: break-word;
                overflow: hidden;
            }
            
            .horario-celula {
                width: 60px;
                font-size: 0.8rem;
                padding: 5px !important;
            }
            
            .agendamento-ocupado {
                font-size: 0.8rem;
                line-height: 1.1;
                padding: 3px 5px !important;
                border-left: 3px solid var(--primary-color);
            }
            
            .agendamento-ocupado strong {
                font-size: 0.85rem;
            }
            
            .agendamento-vago,
            .agendamento-vencido {
                font-size: 0.8rem;
                line-height: 35px;
                padding: 0 5px;
            }
            
            /* Garantir que o conteúdo não ultrapasse os limites */
            #tabela-visao-diaria td:not(.horario-celula) {
                max-width: 200px;
                white-space: normal;
            }

            /* 2. Correção de Tabelas (Cartão-like View) */
            .data-table, .data-table tbody, .data-table td, .data-table tr {
                display: block;
            }

            .data-table thead {
                display: none;
            }

            .data-table tr {
                border: 2px solid var(--border-color);
                margin-bottom: 15px;
                border-radius: 10px;
                box-shadow: 0 2px 8px var(--shadow-color);
                padding: 10px;
            }

            .data-table td {
                border: none;
                position: relative;
                padding-left: 50% !important;
                text-align: right;
                white-space: normal;
                min-height: 40px;
            }

            /* Rótulo customizado (que usa o data-label do JS) */
            .data-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%; 
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: var(--primary-color);
            }
            
            /* FIX V6: Organização dos botões de ação em mobile */
            .data-table td.action-buttons {
                text-align: left;
                padding-left: 10px !important;
                display: flex; 
                flex-direction: column;
                gap: 5px;
            }
            
            .data-table td.action-buttons::before {
                content: "Ações";
                width: 100%; 
                margin-bottom: 5px;
                display: block;
            }
            
            .data-table td.action-buttons button {
                margin: 0;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                font-size: 0.9rem; 
                padding: 8px 5px;
            }
            
            /* Modal em mobile */
            .modal-content {
                width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div id="notification-bar"></div>

    <!-- Modal para usar pacote -->
    <div id="modal-usar-pacote" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agendar Uso de Pacote</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="form-usar-pacote">
                <input type="hidden" id="modal-pacote-id">
                <input type="hidden" id="modal-pacote-servico-id">
                <input type="hidden" id="modal-pacote-cliente-id">
                
                <div class="form-group">
                    <label for="modal-pacote-data">Data</label>
                    <input type="date" id="modal-pacote-data" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modal-pacote-hora">Hora Início</label>
                        <input type="time" id="modal-pacote-hora" required>
                    </div>
                    <div class="form-group">
                        <label for="modal-pacote-hora-fim">Hora Fim</label>
                        <input type="time" id="modal-pacote-hora-fim" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="modal-pacote-procedimento">Procedimento Realizado</label>
                    <select id="modal-pacote-procedimento" required>
                        <option value="">Selecione o procedimento</option>
                        <option value="Pés" data-quantidade="1">Pés (1 procedimento)</option>
                        <option value="Mãos" data-quantidade="1">Mãos (1 procedimento)</option>
                        <option value="Pés e Mãos" data-quantidade="2">Pés e Mãos (2 procedimentos)</option>
                        <option value="Outro" data-quantidade="1">Outro (1 procedimento)</option>
                    </select>
                </div>
                
                <div class="form-group" id="group-outro-procedimento" style="display: none;">
                    <label for="modal-pacote-outro">Descreva o procedimento</label>
                    <input type="text" id="modal-pacote-outro" placeholder="Digite o procedimento realizado">
                </div>
                
                <div class="form-group">
                    <label for="modal-pacote-observacoes">Observações Adicionais</label>
                    <textarea id="modal-pacote-observacoes" rows="2" placeholder="Observações sobre o serviço..."></textarea>
                </div>
                
                <div class="flex-container">
                    <button type="submit" class="btn-success">
                        <span class="material-icons">check_circle</span> Confirmar Uso
                    </button>
                    <button type="button" class="btn-secondary" id="cancelar-usar-pacote">
                        <span class="material-icons">cancel</span> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- NOVO: Modal para limpeza de dados -->
    <div id="modal-limpeza-dados" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Limpeza de Dados</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p><strong>Atenção:</strong> Esta ação não pode ser desfeita!</p>
                <label>
                    <input type="checkbox" id="confirmar-limpeza"> Confirmo que desejo prosseguir com a limpeza
                </label>
            </div>
            <div class="flex-container">
                <button type="button" class="btn-danger" id="btn-limpar-historico" disabled>
                    <span class="material-icons">delete_forever</span> Limpar Apenas Histórico
                </button>
                <button type="button" class="btn-danger" id="btn-limpar-tudo" disabled>
                    <span class="material-icons">delete_sweep</span> Limpar Tudo (exceto Clientes/Serviços)
                </button>
                <button type="button" class="btn-secondary" id="cancelar-limpeza">
                    <span class="material-icons">cancel</span> Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="login-container">
        <div class="login-card">
            <div class="login-icon">
                <!-- Alterado o ícone para algo mais relacionado a manicure -->
                <span class="material-icons">content_cut</span>
            </div>
            <h1>Tati Manicure - Acesso</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="loginSenha">Senha de Acesso</label>
                    <input type="password" id="loginSenha" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">
                    <span class="material-icons">login</span> Entrar
                </button>
            </form>
        </div>
    </div>

    <datalist id="clientes-datalist"></datalist>

    <div id="app-container">
        
        <aside class="sidebar">
            <div class="logo">TATI MANICURE APP</div>
            
            <ul>
                <li><a href="#" data-section="agenda" class="active"><span class="material-icons">calendar_today</span> Agenda</a></li>
                <li><a href="#" data-section="clientes"><span class="material-icons">people</span> Clientes</a></li>
                <li><a href="#" data-section="servicos"><span class="material-icons">local_offer</span> Serviços</a></li>
                <li><a href="#" data-section="historico"><span class="material-icons">history</span> Histórico/Lucros</a></li>
            </ul>

            <div class="user-info">
                <p id="userInfo">Olá, Tati!</p>
                <button id="logout-button" class="btn-danger" style="width: 100%;">
                    <span class="material-icons">logout</span> Sair
                </button>
            </div>
        </aside>

        <main class="main-content">

            <div id="agenda-section" class="content-section active">
                
                <div class="tab-menu">
                     <button class="tab-button active" onclick="showAgendaTab('pacotes-ativos', event)">Pacotes Ativos</button>
                     <button class="tab-button" onclick="showAgendaTab('novo-agendamento', event)">Novo Agendamento</button>
                     <button class="tab-button" onclick="showAgendaTab('lista-agendamentos', event)">Lista Agendamentos</button>
                     <button class="tab-button" onclick="showAgendaTab('visao-diaria', event)">Visão Diária</button>
                </div>
                
                <div class="tab-content">
                    
                    <div id="pacotes-ativos-pane" class="tab-pane active">
                         <div class="section-header"><h2>Gerenciamento de Pacotes Ativos</h2></div>
                         <div class="card">
                            <form id="pacote-inicio-form">
                                <h3>Iniciar Novo Pacote de Serviços</h3>
                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label for="pacote-cliente-id">Cliente</label>
                                        <select id="pacote-cliente-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 2;">
                                        <label for="pacote-servico-id">Pacote (Serviços marcados como Pacote)</label>
                                        <select id="pacote-servico-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label for="pacote-data-inicio">Data Início (Geralmente Hoje)</label>
                                        <input type="date" id="pacote-data-inicio" required>
                                    </div>
                                </div>

                                <div class="flex-container">
                                    <button type="submit" class="btn-primary">
                                        <span class="material-icons">add_box</span> Iniciar/Vender Pacote
                                    </button>
                                </div>
                            </form>
                            
                            <hr style="margin: 20px 0; border-color: var(--border-color);">

                            <h3>Pacotes Ativos e Utilização</h3>
                            <div style="max-height: 500px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 20%;">Cliente</th>
                                            <th style="width: 25%;">Pacote (Total/Usado)</th>
                                            <th style="width: 15%;">Pagamento</th>
                                            <th style="width: 15%;">Vencimento</th>
                                            <th style="width: 200px;">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-pacotes-ativos">
                                        <tr><td colspan="5" style="text-align: center;">Carregando pacotes ativos...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div id="novo-agendamento-pane" class="tab-pane">
                        <div class="section-header"><h2>Agendar Serviço Avulso</h2></div>
                        <div class="card">
                            <form id="agendamento-form">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label for="agendamento-cliente-id">Cliente</label>
                                        <select id="agendamento-cliente-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 2;">
                                        <label for="agendamento-servico-id">Serviço</label>
                                        <select id="agendamento-servico-id" required></select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group" style="flex: 1;">
                                        <label for="agendamento-data">Data</label>
                                        <input type="date" id="agendamento-data" required>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label for="agendamento-hora">Hora Início</label>
                                        <input type="time" id="agendamento-hora" required>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label for="agendamento-hora-fim">Hora Fim</label>
                                        <input type="time" id="agendamento-hora-fim" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="agendamento-observacoes">Observações</label>
                                    <textarea id="agendamento-observacoes" rows="2" placeholder="Observações sobre o agendamento..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="agendamento-valor">Valor (R$)</label>
                                    <input type="number" id="agendamento-valor" step="0.01" min="0" placeholder="0.00" required>
                                </div>
                                
                                <div class="flex-container">
                                    <button type="submit" class="btn-primary">
                                        <span class="material-icons">event_available</span> Agendar Serviço
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="lista-agendamentos-pane" class="tab-pane">
                         <div class="section-header"><h2>Lista de Agendamentos</h2></div>
                         <div class="card">
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filtro-data-agendamento">Filtrar por Data</label>
                                    <input type="date" id="filtro-data-agendamento">
                                </div>
                                <div class="form-group">
                                    <label for="filtro-status-agendamento">Filtrar por Status</label>
                                    <select id="filtro-status-agendamento">
                                        <option value="">Todos</option>
                                        <option value="agendado">Agendado</option>
                                        <option value="realizado">Realizado</option>
                                        <option value="cancelado">Cancelado</option>
                                    </select>
                                </div>
                                <button id="btn-filtrar-agendamentos" class="btn-info">
                                    <span class="material-icons">filter_list</span> Filtrar
                                </button>
                                <button id="btn-limpar-filtros-agendamentos" class="btn-secondary">
                                    <span class="material-icons">clear</span> Limpar
                                </button>
                            </div>
                            
                            <div style="max-height: 500px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 15%;">Data</th>
                                            <th style="width: 15%;">Horário</th>
                                            <th style="width: 20%;">Cliente</th>
                                            <th style="width: 20%;">Serviço</th>
                                            <th style="width: 10%;">Valor</th>
                                            <th style="width: 10%;">Status</th>
                                            <th style="width: 100px;">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-agendamentos">
                                        <tr><td colspan="7" style="text-align: center;">Carregando agendamentos...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div id="visao-diaria-pane" class="tab-pane">
                         <div class="section-header"><h2>Visão Diária da Agenda</h2></div>
                         <div class="card">
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filtro-data-visao">Data para Visualizar</label>
                                    <input type="date" id="filtro-data-visao">
                                </div>
                                <button id="btn-carregar-visao" class="btn-primary">
                                    <span class="material-icons">refresh</span> Carregar
                                </button>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="data-table" id="tabela-visao-diaria">
                                    <thead>
                                        <tr>
                                            <th style="width: 80px;">Horário</th>
                                            <th>Agendamentos</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corpo-visao-diaria">
                                        <tr><td colspan="2" style="text-align: center;">Selecione uma data para visualizar a agenda</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="clientes-section" class="content-section">
                <div class="section-header"><h2>Gerenciamento de Clientes</h2></div>
                <div class="card">
                    <h3>Cadastrar Novo Cliente</h3>
                    <form id="cliente-form">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="cliente-nome">Nome Completo</label>
                                <input type="text" id="cliente-nome" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="cliente-telefone">Telefone</label>
                                <input type="tel" id="cliente-telefone" placeholder="(00) 00000-0000">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="cliente-email">E-mail</label>
                                <input type="email" id="cliente-email">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="cliente-aniversario">Data de Nascimento</label>
                                <input type="date" id="cliente-aniversario">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cliente-observacoes">Observações</label>
                            <textarea id="cliente-observacoes" rows="2" placeholder="Observações sobre o cliente..."></textarea>
                        </div>
                        
                        <div class="flex-container">
                            <button type="submit" class="btn-primary">
                                <span class="material-icons">person_add</span> Cadastrar Cliente
                            </button>
                        </div>
                    </form>
                    
                    <hr style="margin: 20px 0; border-color: var(--border-color);">
                    
                    <h3>Lista de Clientes Cadastrados</h3>
                    <div class="filter-row">
                        <div class="form-group">
                            <label for="filtro-cliente-nome">Filtrar por Nome</label>
                            <input type="text" id="filtro-cliente-nome" placeholder="Digite o nome do cliente">
                        </div>
                        <button id="btn-filtrar-clientes" class="btn-info">
                            <span class="material-icons">search</span> Buscar
                        </button>
                        <button id="btn-limpar-filtros-clientes" class="btn-secondary">
                            <span class="material-icons">clear</span> Limpar
                        </button>
                    </div>
                    
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Nome</th>
                                    <th style="width: 20%;">Telefone</th>
                                    <th style="width: 25%;">E-mail</th>
                                    <th style="width: 15%;">Aniversário</th>
                                    <th style="width: 150px;">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lista-clientes">
                                <tr><td colspan="5" style="text-align: center;">Carregando clientes...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="servicos-section" class="content-section">
                <div class="section-header"><h2>Gerenciamento de Serviços</h2></div>
                <div class="card">
                    <h3>Cadastrar Novo Serviço</h3>
                    <form id="servico-form">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="servico-nome">Nome do Serviço</label>
                                <input type="text" id="servico-nome" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-valor">Valor (R$)</label>
                                <input type="number" id="servico-valor" step="0.01" min="0" placeholder="0.00" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-duracao">Duração (minutos)</label>
                                <input type="number" id="servico-duracao" min="1" value="60" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-tipo">Tipo de Serviço</label>
                                <select id="servico-tipo" required>
                                    <option value="avulso">Serviço Avulso</option>
                                    <option value="pacote">Pacote de Serviços</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-sessoes">Sessões (se for pacote)</label>
                                <input type="number" id="servico-sessoes" min="1" value="1" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="servico-descricao">Descrição do Serviço</label>
                            <textarea id="servico-descricao" rows="2" placeholder="Descrição detalhada do serviço..."></textarea>
                        </div>
                        
                        <div class="flex-container">
                            <button type="submit" class="btn-primary">
                                <span class="material-icons">add_circle</span> Cadastrar Serviço
                            </button>
                        </div>
                    </form>
                    
                    <hr style="margin: 20px 0; border-color: var(--border-color);">
                    
                    <h3>Lista de Serviços Cadastrados</h3>
                    <div class="filter-row">
                        <div class="form-group">
                            <label for="filtro-servico-nome">Filtrar por Nome</label>
                            <input type="text" id="filtro-servico-nome" placeholder="Digite o nome do serviço">
                        </div>
                        <div class="form-group">
                            <label for="filtro-servico-tipo">Filtrar por Tipo</label>
                            <select id="filtro-servico-tipo">
                                <option value="">Todos</option>
                                <option value="avulso">Avulso</option>
                                <option value="pacote">Pacote</option>
                            </select>
                        </div>
                        <button id="btn-filtrar-servicos" class="btn-info">
                            <span class="material-icons">search</span> Buscar
                        </button>
                        <button id="btn-limpar-filtros-servicos" class="btn-secondary">
                            <span class="material-icons">clear</span> Limpar
                        </button>
                    </div>
                    
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Nome</th>
                                    <th style="width: 15%;">Valor</th>
                                    <th style="width: 15%;">Duração</th>
                                    <th style="width: 15%;">Tipo</th>
                                    <th style="width: 15%;">Sessões</th>
                                    <th style="width: 100px;">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lista-servicos">
                                <tr><td colspan="6" style="text-align: center;">Carregando serviços...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="historico-section" class="content-section">
                
                <div class="tab-menu">
                     <button class="tab-button active" onclick="showHistoricoTab('resumo-lucros', event)">Resumo de Lucros</button>
                     <button class="tab-button" onclick="showHistoricoTab('historico-completo', event)">Histórico Completo</button>
                </div>
                
                <div class="tab-content">
                    
                    <div id="resumo-lucros-pane" class="tab-pane active">
                         <div class="section-header"><h2>Resumo de Lucros - Todos os Meses</h2></div>
                         <div class="card">
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filtro-mes-resumo">Filtrar por Mês/Ano</label>
                                    <input type="month" id="filtro-mes-resumo">
                                </div>
                                <button id="btn-filtrar-resumo" class="btn-info">
                                    <span class="material-icons">filter_list</span> Filtrar
                                </button>
                                <button id="btn-limpar-filtros-resumo" class="btn-secondary">
                                    <span class="material-icons">clear</span> Limpar
                                </button>
                            </div>
                            
                            <div id="resumo-mensal-lucros">
                                <p>Carregando resumo de lucros...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="historico-completo-pane" class="tab-pane">
                         <div class="section-header"><h2>Histórico Completo de Serviços</h2></div>
                         <div class="card">
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filtro-data-inicio">Data Início</label>
                                    <input type="date" id="filtro-data-inicio">
                                </div>
                                <div class="form-group">
                                    <label for="filtro-data-fim">Data Fim</label>
                                    <input type="date" id="filtro-data-fim">
                                </div>
                                <div class="form-group">
                                    <label for="filtro-tipo-servico">Tipo de Serviço</label>
                                    <select id="filtro-tipo-servico">
                                        <option value="">Todos</option>
                                        <option value="avulso">Avulso</option>
                                        <option value="pacote">Pacote</option>
                                    </select>
                                </div>
                                <button id="btn-filtrar-historico" class="btn-info">
                                    <span class="material-icons">filter_list</span> Filtrar
                                </button>
                                <button id="btn-limpar-filtros-historico" class="btn-secondary">
                                    <span class="material-icons">clear</span> Limpar
                                </button>
                            </div>
                            
                            <div style="max-height: 500px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 15%;">Data</th>
                                            <th style="width: 15%;">Horário</th>
                                            <th style="width: 20%;">Cliente</th>
                                            <th style="width: 20%;">Serviço</th>
                                            <th style="width: 10%;">Valor</th>
                                            <th style="width: 10%;">Tipo</th>
                                            <th style="width: 10%;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-historico">
                                        <tr><td colspan="7" style="text-align: center;">Carregando histórico...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // =============================================
        // VARIÁVEIS GLOBAIS E INICIALIZAÇÃO
        // =============================================
        const APP_KEY = 'tatiManicureApp';
        let appData = {
            clientes: [],
            servicos: [],
            agendamentos: [],
            pacotes: [],
            historico: [],
            config: {
                senhaAcesso: '1234'
            }
        };

        // =============================================
        // FUNÇÕES DE INICIALIZAÇÃO
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar dados salvos
            loadAppData();
            
            // Inicializar data atual nos campos de data
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('agendamento-data').value = today;
            document.getElementById('pacote-data-inicio').value = today;
            document.getElementById('filtro-data-visao').value = today;
            
            // Configurar eventos de login
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('logout-button').addEventListener('click', handleLogout);
            
            // Configurar navegação
            setupNavigation();
            
            // Carregar dados iniciais
            loadClientesForSelect();
            loadServicosForSelect();
            loadPacotesAtivos();
            loadAgendamentos();
            loadClientes();
            loadServicos();
            loadHistorico();
            loadResumoLucros();
            
            // Configurar formulários
            setupForms();
            
            // Configurar filtros
            setupFilters();
            
            // Configurar modais
            setupModals();
            
            // Configurar responsividade para tabelas
            setupResponsiveTables();
        });

        function loadAppData() {
            const savedData = localStorage.getItem(APP_KEY);
            if (savedData) {
                appData = JSON.parse(savedData);
            }
        }

        function saveAppData() {
            localStorage.setItem(APP_KEY, JSON.stringify(appData));
        }

        // =============================================
        // FUNÇÕES DE AUTENTICAÇÃO
        // =============================================
        function handleLogin(e) {
            e.preventDefault();
            const senha = document.getElementById('loginSenha').value;
            
            if (senha === appData.config.senhaAcesso) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                showNotification('Login realizado com sucesso!', 'success');
            } else {
                showNotification('Senha incorreta! Tente novamente.', 'error');
            }
        }

        function handleLogout() {
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('loginSenha').value = '';
            showNotification('Logout realizado com sucesso!', 'info');
        }

        // =============================================
        // FUNÇÕES DE NAVEGAÇÃO
        // =============================================
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.sidebar a[data-section]');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remover classe active de todos os links
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // Adicionar classe active ao link clicado
                    this.classList.add('active');
                    
                    // Esconder todas as seções
                    const sections = document.querySelectorAll('.content-section');
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // Mostrar a seção correspondente
                    const sectionId = this.getAttribute('data-section') + '-section';
                    document.getElementById(sectionId).classList.add('active');
                });
            });
        }

        // =============================================
        // FUNÇÕES DE FORMULÁRIOS
        // =============================================
        function setupForms() {
            // Formulário de Cliente
            document.getElementById('cliente-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addCliente();
            });
            
            // Formulário de Serviço
            document.getElementById('servico-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addServico();
            });
            
            // Formulário de Agendamento
            document.getElementById('agendamento-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addAgendamento();
            });
            
            // Formulário de Pacote
            document.getElementById('pacote-inicio-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addPacote();
            });
            
            // Formulário de Usar Pacote (Modal)
            document.getElementById('form-usar-pacote').addEventListener('submit', function(e) {
                e.preventDefault();
                usarPacote();
            });
            
            // Evento para mostrar campo "Outro" quando selecionado
            document.getElementById('modal-pacote-procedimento').addEventListener('change', function() {
                const outroGroup = document.getElementById('group-outro-procedimento');
                outroGroup.style.display = this.value === 'Outro' ? 'block' : 'none';
            });
            
            // Evento para atualizar hora fim quando hora início muda
            document.getElementById('agendamento-hora').addEventListener('change', function() {
                updateHoraFim('agendamento-hora', 'agendamento-hora-fim');
            });
            
            document.getElementById('modal-pacote-hora').addEventListener('change', function() {
                updateHoraFim('modal-pacote-hora', 'modal-pacote-hora-fim');
            });
            
            // Evento para atualizar valor quando serviço é selecionado
            document.getElementById('agendamento-servico-id').addEventListener('change', function() {
                updateValorServico();
            });
        }

        function updateHoraFim(horaInicioId, horaFimId) {
            const horaInicio = document.getElementById(horaInicioId).value;
            if (horaInicio) {
                const [horas, minutos] = horaInicio.split(':').map(Number);
                const duracao = 60; // 1 hora padrão
                
                let horasFim = horas + Math.floor(duracao / 60);
                let minutosFim = minutos + (duracao % 60);
                
                if (minutosFim >= 60) {
                    minutosFim -= 60;
                    horasFim += 1;
                }
                
                if (horasFim >= 24) {
                    horasFim -= 24;
                }
                
                const horaFim = `${horasFim.toString().padStart(2, '0')}:${minutosFim.toString().padStart(2, '0')}`;
                document.getElementById(horaFimId).value = horaFim;
            }
        }

        function updateValorServico() {
            const servicoId = document.getElementById('agendamento-servico-id').value;
            if (servicoId) {
                const servico = appData.servicos.find(s => s.id == servicoId);
                if (servico) {
                    document.getElementById('agendamento-valor').value = servico.valor;
                }
            }
        }

        // =============================================
        // FUNÇÕES DE FILTROS
        // =============================================
        function setupFilters() {
            // Filtros de Clientes
            document.getElementById('btn-filtrar-clientes').addEventListener('click', function() {
                loadClientes();
            });
            
            document.getElementById('btn-limpar-filtros-clientes').addEventListener('click', function() {
                document.getElementById('filtro-cliente-nome').value = '';
                loadClientes();
            });
            
            // Filtros de Serviços
            document.getElementById('btn-filtrar-servicos').addEventListener('click', function() {
                loadServicos();
            });
            
            document.getElementById('btn-limpar-filtros-servicos').addEventListener('click', function() {
                document.getElementById('filtro-servico-nome').value = '';
                document.getElementById('filtro-servico-tipo').value = '';
                loadServicos();
            });
            
            // Filtros de Agendamentos
            document.getElementById('btn-filtrar-agendamentos').addEventListener('click', function() {
                loadAgendamentos();
            });
            
            document.getElementById('btn-limpar-filtros-agendamentos').addEventListener('click', function() {
                document.getElementById('filtro-data-agendamento').value = '';
                document.getElementById('filtro-status-agendamento').value = '';
                loadAgendamentos();
            });
            
            // Filtros de Histórico
            document.getElementById('btn-filtrar-historico').addEventListener('click', function() {
                loadHistorico();
            });
            
            document.getElementById('btn-limpar-filtros-historico').addEventListener('click', function() {
                document.getElementById('filtro-data-inicio').value = '';
                document.getElementById('filtro-data-fim').value = '';
                document.getElementById('filtro-tipo-servico').value = '';
                loadHistorico();
            });
            
            // Filtros de Resumo
            document.getElementById('btn-filtrar-resumo').addEventListener('click', function() {
                loadResumoLucros();
            });
            
            document.getElementById('btn-limpar-filtros-resumo').addEventListener('click', function() {
                document.getElementById('filtro-mes-resumo').value = '';
                loadResumoLucros();
            });
            
            // Botão para carregar visão diária
            document.getElementById('btn-carregar-visao').addEventListener('click', function() {
                loadVisaoDiaria();
            });
        }

        // =============================================
        // FUNÇÕES DE MODAIS
        // =============================================
        function setupModals() {
            // Modal de Usar Pacote
            const modalUsarPacote = document.getElementById('modal-usar-pacote');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const cancelarUsarPacote = document.getElementById('cancelar-usar-pacote');
            
            closeModalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    modalUsarPacote.style.display = 'none';
                });
            });
            
            cancelarUsarPacote.addEventListener('click', function() {
                modalUsarPacote.style.display = 'none';
            });
            
            // Fechar modal ao clicar fora
            window.addEventListener('click', function(e) {
                if (e.target === modalUsarPacote) {
                    modalUsarPacote.style.display = 'none';
                }
            });
        }

        function abrirModalUsarPacote(pacoteId, servicoId, clienteId) {
            document.getElementById('modal-pacote-id').value = pacoteId;
            document.getElementById('modal-pacote-servico-id').value = servicoId;
            document.getElementById('modal-pacote-cliente-id').value = clienteId;
            
            // Limpar campos do modal
            document.getElementById('modal-pacote-data').value = new Date().toISOString().split('T')[0];
            document.getElementById('modal-pacote-hora').value = '';
            document.getElementById('modal-pacote-hora-fim').value = '';
            document.getElementById('modal-pacote-procedimento').value = '';
            document.getElementById('modal-pacote-outro').value = '';
            document.getElementById('modal-pacote-observacoes').value = '';
            document.getElementById('group-outro-procedimento').style.display = 'none';
            
            document.getElementById('modal-usar-pacote').style.display = 'flex';
        }

        // =============================================
        // FUNÇÕES DE CLIENTES
        // =============================================
        function loadClientesForSelect() {
            const selectClienteAgendamento = document.getElementById('agendamento-cliente-id');
            const selectClientePacote = document.getElementById('pacote-cliente-id');
            
            // Limpar opções existentes
            selectClienteAgendamento.innerHTML = '<option value="">Selecione um cliente</option>';
            selectClientePacote.innerHTML = '<option value="">Selecione um cliente</option>';
            
            // Adicionar clientes
            appData.clientes.forEach(cliente => {
                const option = `<option value="${cliente.id}">${cliente.nome}</option>`;
                selectClienteAgendamento.innerHTML += option;
                selectClientePacote.innerHTML += option;
            });
        }

        function loadClientes() {
            const tbody = document.getElementById('lista-clientes');
            const filtroNome = document.getElementById('filtro-cliente-nome').value.toLowerCase();
            
            // Filtrar clientes
            let clientesFiltrados = appData.clientes;
            if (filtroNome) {
                clientesFiltrados = clientesFiltrados.filter(cliente => 
                    cliente.nome.toLowerCase().includes(filtroNome)
                );
            }
            
            // Gerar HTML da tabela
            if (clientesFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum cliente encontrado</td></tr>';
                return;
            }
            
            let html = '';
            clientesFiltrados.forEach(cliente => {
                const aniversario = cliente.aniversario ? new Date(cliente.aniversario).toLocaleDateString('pt-BR') : '-';
                
                html += `
                <tr>
                    <td data-label="Nome">${cliente.nome}</td>
                    <td data-label="Telefone">${cliente.telefone || '-'}</td>
                    <td data-label="E-mail">${cliente.email || '-'}</td>
                    <td data-label="Aniversário">${aniversario}</td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-warning" onclick="editarCliente(${cliente.id})">
                            <span class="material-icons">edit</span> Editar
                        </button>
                        <button class="btn-danger" onclick="excluirCliente(${cliente.id})">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function addCliente() {
            const nome = document.getElementById('cliente-nome').value;
            const telefone = document.getElementById('cliente-telefone').value;
            const email = document.getElementById('cliente-email').value;
            const aniversario = document.getElementById('cliente-aniversario').value;
            const observacoes = document.getElementById('cliente-observacoes').value;
            
            const novoCliente = {
                id: Date.now(),
                nome,
                telefone,
                email,
                aniversario,
                observacoes,
                dataCadastro: new Date().toISOString()
            };
            
            appData.clientes.push(novoCliente);
            saveAppData();
            
            // Limpar formulário
            document.getElementById('cliente-form').reset();
            
            // Recarregar listas
            loadClientesForSelect();
            loadClientes();
            
            showNotification('Cliente cadastrado com sucesso!', 'success');
        }

        function editarCliente(id) {
            const cliente = appData.clientes.find(c => c.id === id);
            if (!cliente) return;
            
            document.getElementById('cliente-nome').value = cliente.nome;
            document.getElementById('cliente-telefone').value = cliente.telefone || '';
            document.getElementById('cliente-email').value = cliente.email || '';
            document.getElementById('cliente-aniversario').value = cliente.aniversario || '';
            document.getElementById('cliente-observacoes').value = cliente.observacoes || '';
            
            // Remover cliente da lista (será readicionado no submit)
            appData.clientes = appData.clientes.filter(c => c.id !== id);
            
            // Atualizar formulário para modo de edição
            const form = document.getElementById('cliente-form');
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.innerHTML = '<span class="material-icons">save</span> Atualizar Cliente';
            submitButton.onclick = function(e) {
                e.preventDefault();
                addCliente(); // Reutiliza a função de adicionar para atualizar
                submitButton.innerHTML = '<span class="material-icons">person_add</span> Cadastrar Cliente';
                submitButton.onclick = null;
            };
            
            showNotification('Editando cliente: ' + cliente.nome, 'info');
        }

        function excluirCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                appData.clientes = appData.clientes.filter(c => c.id !== id);
                saveAppData();
                loadClientesForSelect();
                loadClientes();
                showNotification('Cliente excluído com sucesso!', 'success');
            }
        }

        // =============================================
        // FUNÇÕES DE SERVIÇOS
        // =============================================
        function loadServicosForSelect() {
            const selectServicoAgendamento = document.getElementById('agendamento-servico-id');
            const selectServicoPacote = document.getElementById('pacote-servico-id');
            
            // Limpar opções existentes
            selectServicoAgendamento.innerHTML = '<option value="">Selecione um serviço</option>';
            selectServicoPacote.innerHTML = '<option value="">Selecione um pacote</option>';
            
            // Adicionar serviços avulsos para agendamento
            appData.servicos.filter(s => s.tipo === 'avulso').forEach(servico => {
                selectServicoAgendamento.innerHTML += `<option value="${servico.id}">${servico.nome} - R$ ${servico.valor.toFixed(2)}</option>`;
            });
            
            // Adicionar serviços do tipo pacote para venda de pacotes
            appData.servicos.filter(s => s.tipo === 'pacote').forEach(servico => {
                selectServicoPacote.innerHTML += `<option value="${servico.id}">${servico.nome} - ${servico.sessoes} sessões - R$ ${servico.valor.toFixed(2)}</option>`;
            });
        }

        function loadServicos() {
            const tbody = document.getElementById('lista-servicos');
            const filtroNome = document.getElementById('filtro-servico-nome').value.toLowerCase();
            const filtroTipo = document.getElementById('filtro-servico-tipo').value;
            
            // Filtrar serviços
            let servicosFiltrados = appData.servicos;
            if (filtroNome) {
                servicosFiltrados = servicosFiltrados.filter(servico => 
                    servico.nome.toLowerCase().includes(filtroNome)
                );
            }
            if (filtroTipo) {
                servicosFiltrados = servicosFiltrados.filter(servico => 
                    servico.tipo === filtroTipo
                );
            }
            
            // Gerar HTML da tabela
            if (servicosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum serviço encontrado</td></tr>';
                return;
            }
            
            let html = '';
            servicosFiltrados.forEach(servico => {
                html += `
                <tr>
                    <td data-label="Nome">${servico.nome}</td>
                    <td data-label="Valor">R$ ${servico.valor.toFixed(2)}</td>
                    <td data-label="Duração">${servico.duracao} min</td>
                    <td data-label="Tipo">${servico.tipo === 'avulso' ? 'Avulso' : 'Pacote'}</td>
                    <td data-label="Sessões">${servico.sessoes}</td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-warning" onclick="editarServico(${servico.id})">
                            <span class="material-icons">edit</span> Editar
                        </button>
                        <button class="btn-danger" onclick="excluirServico(${servico.id})">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function addServico() {
            const nome = document.getElementById('servico-nome').value;
            const valor = parseFloat(document.getElementById('servico-valor').value);
            const duracao = parseInt(document.getElementById('servico-duracao').value);
            const tipo = document.getElementById('servico-tipo').value;
            const sessoes = parseInt(document.getElementById('servico-sessoes').value);
            const descricao = document.getElementById('servico-descricao').value;
            
            const novoServico = {
                id: Date.now(),
                nome,
                valor,
                duracao,
                tipo,
                sessoes,
                descricao,
                dataCadastro: new Date().toISOString()
            };
            
            appData.servicos.push(novoServico);
            saveAppData();
            
            // Limpar formulário
            document.getElementById('servico-form').reset();
            document.getElementById('servico-duracao').value = 60;
            document.getElementById('servico-sessoes').value = 1;
            
            // Recarregar listas
            loadServicosForSelect();
            loadServicos();
            
            showNotification('Serviço cadastrado com sucesso!', 'success');
        }

        function editarServico(id) {
            const servico = appData.servicos.find(s => s.id === id);
            if (!servico) return;
            
            document.getElementById('servico-nome').value = servico.nome;
            document.getElementById('servico-valor').value = servico.valor;
            document.getElementById('servico-duracao').value = servico.duracao;
            document.getElementById('servico-tipo').value = servico.tipo;
            document.getElementById('servico-sessoes').value = servico.sessoes;
            document.getElementById('servico-descricao').value = servico.descricao || '';
            
            // Remover serviço da lista (será readicionado no submit)
            appData.servicos = appData.servicos.filter(s => s.id !== id);
            
            // Atualizar formulário para modo de edição
            const form = document.getElementById('servico-form');
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.innerHTML = '<span class="material-icons">save</span> Atualizar Serviço';
            submitButton.onclick = function(e) {
                e.preventDefault();
                addServico(); // Reutiliza a função de adicionar para atualizar
                submitButton.innerHTML = '<span class="material-icons">add_circle</span> Cadastrar Serviço';
                submitButton.onclick = null;
            };
            
            showNotification('Editando serviço: ' + servico.nome, 'info');
        }

        function excluirServico(id) {
            if (confirm('Tem certeza que deseja excluir este serviço?')) {
                appData.servicos = appData.servicos.filter(s => s.id !== id);
                saveAppData();
                loadServicosForSelect();
                loadServicos();
                showNotification('Serviço excluído com sucesso!', 'success');
            }
        }

        // =============================================
        // FUNÇÕES DE AGENDAMENTOS
        // =============================================
        function loadAgendamentos() {
            const tbody = document.getElementById('lista-agendamentos');
            const filtroData = document.getElementById('filtro-data-agendamento').value;
            const filtroStatus = document.getElementById('filtro-status-agendamento').value;
            
            // Filtrar agendamentos
            let agendamentosFiltrados = appData.agendamentos;
            if (filtroData) {
                agendamentosFiltrados = agendamentosFiltrados.filter(agendamento => 
                    agendamento.data === filtroData
                );
            }
            if (filtroStatus) {
                agendamentosFiltrados = agendamentosFiltrados.filter(agendamento => 
                    agendamento.status === filtroStatus
                );
            }
            
            // Ordenar por data e hora
            agendamentosFiltrados.sort((a, b) => {
                const dataA = new Date(a.data + 'T' + a.hora);
                const dataB = new Date(b.data + 'T' + b.hora);
                return dataA - dataB;
            });
            
            // Gerar HTML da tabela
            if (agendamentosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum agendamento encontrado</td></tr>';
                return;
            }
            
            let html = '';
            agendamentosFiltrados.forEach(agendamento => {
                const cliente = appData.clientes.find(c => c.id == agendamento.clienteId);
                const servico = appData.servicos.find(s => s.id == agendamento.servicoId);
                
                if (!cliente || !servico) return;
                
                const dataFormatada = new Date(agendamento.data).toLocaleDateString('pt-BR');
                let statusText = '';
                let statusClass = '';
                
                switch(agendamento.status) {
                    case 'agendado':
                        statusText = 'Agendado';
                        statusClass = 'status-package-pending';
                        break;
                    case 'realizado':
                        statusText = 'Realizado';
                        statusClass = 'status-package-active';
                        break;
                    case 'cancelado':
                        statusText = 'Cancelado';
                        statusClass = 'status-package-finalized';
                        break;
                }
                
                html += `
                <tr>
                    <td data-label="Data">${dataFormatada}</td>
                    <td data-label="Horário">${agendamento.hora} - ${agendamento.horaFim}</td>
                    <td data-label="Cliente">${cliente.nome}</td>
                    <td data-label="Serviço">${servico.nome}</td>
                    <td data-label="Valor">R$ ${agendamento.valor.toFixed(2)}</td>
                    <td data-label="Status" class="${statusClass}">${statusText}</td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-success" onclick="marcarRealizado(${agendamento.id})" ${agendamento.status !== 'agendado' ? 'disabled' : ''}>
                            <span class="material-icons">check_circle</span> Realizado
                        </button>
                        <button class="btn-danger" onclick="cancelarAgendamento(${agendamento.id})" ${agendamento.status !== 'agendado' ? 'disabled' : ''}>
                            <span class="material-icons">cancel</span> Cancelar
                        </button>
                    </td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function addAgendamento() {
            const clienteId = document.getElementById('agendamento-cliente-id').value;
            const servicoId = document.getElementById('agendamento-servico-id').value;
            const data = document.getElementById('agendamento-data').value;
            const hora = document.getElementById('agendamento-hora').value;
            const horaFim = document.getElementById('agendamento-hora-fim').value;
            const observacoes = document.getElementById('agendamento-observacoes').value;
            const valor = parseFloat(document.getElementById('agendamento-valor').value);
            
            const novoAgendamento = {
                id: Date.now(),
                clienteId: parseInt(clienteId),
                servicoId: parseInt(servicoId),
                data,
                hora,
                horaFim,
                observacoes,
                valor,
                status: 'agendado',
                dataCriacao: new Date().toISOString()
            };
            
            appData.agendamentos.push(novoAgendamento);
            saveAppData();
            
            // Limpar formulário
            document.getElementById('agendamento-form').reset();
            document.getElementById('agendamento-data').value = new Date().toISOString().split('T')[0];
            
            // Recarregar listas
            loadAgendamentos();
            loadVisaoDiaria();
            
            showNotification('Agendamento realizado com sucesso!', 'success');
        }

        function marcarRealizado(id) {
            const agendamento = appData.agendamentos.find(a => a.id === id);
            if (!agendamento) return;
            
            agendamento.status = 'realizado';
            
            // Adicionar ao histórico
            const cliente = appData.clientes.find(c => c.id == agendamento.clienteId);
            const servico = appData.servicos.find(s => s.id == agendamento.servicoId);
            
            if (cliente && servico) {
                const historicoItem = {
                    id: Date.now(),
                    data: agendamento.data,
                    hora: agendamento.hora,
                    clienteId: agendamento.clienteId,
                    clienteNome: cliente.nome,
                    servicoId: agendamento.servicoId,
                    servicoNome: servico.nome,
                    valor: agendamento.valor,
                    tipo: 'avulso',
                    status: 'realizado',
                    dataRegistro: new Date().toISOString()
                };
                
                appData.historico.push(historicoItem);
            }
            
            saveAppData();
            loadAgendamentos();
            loadVisaoDiaria();
            loadHistorico();
            loadResumoLucros();
            
            showNotification('Agendamento marcado como realizado!', 'success');
        }

        function cancelarAgendamento(id) {
            if (confirm('Tem certeza que deseja cancelar este agendamento?')) {
                const agendamento = appData.agendamentos.find(a => a.id === id);
                if (!agendamento) return;
                
                agendamento.status = 'cancelado';
                saveAppData();
                loadAgendamentos();
                loadVisaoDiaria();
                
                showNotification('Agendamento cancelado!', 'success');
            }
        }

        // =============================================
        // FUNÇÕES DE PACOTES
        // =============================================
        function loadPacotesAtivos() {
            const tbody = document.getElementById('lista-pacotes-ativos');
            
            // Filtrar apenas pacotes ativos (não finalizados)
            const pacotesAtivos = appData.pacotes.filter(p => p.status !== 'finalizado');
            
            // Gerar HTML da tabela
            if (pacotesAtivos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum pacote ativo encontrado</td></tr>';
                return;
            }
            
            let html = '';
            pacotesAtivos.forEach(pacote => {
                const cliente = appData.clientes.find(c => c.id == pacote.clienteId);
                const servico = appData.servicos.find(s => s.id == pacote.servicoId);
                
                if (!cliente || !servico) return;
                
                const dataInicio = new Date(pacote.dataInicio).toLocaleDateString('pt-BR');
                const dataVencimento = pacote.dataVencimento ? new Date(pacote.dataVencimento).toLocaleDateString('pt-BR') : '-';
                
                let statusText = '';
                let statusClass = '';
                
                switch(pacote.status) {
                    case 'pendente':
                        statusText = 'Pendente';
                        statusClass = 'status-package-pending';
                        break;
                    case 'pago':
                        statusText = 'Pago';
                        statusClass = 'status-package-paid';
                        break;
                    case 'ativo':
                        statusText = 'Ativo';
                        statusClass = 'status-package-active';
                        break;
                    case 'finalizado':
                        statusText = 'Finalizado';
                        statusClass = 'status-package-finalized';
                        break;
                }
                
                html += `
                <tr>
                    <td data-label="Cliente">${cliente.nome}</td>
                    <td data-label="Pacote">${servico.nome} (${pacote.sessoesUsadas}/${servico.sessoes})</td>
                    <td data-label="Pagamento" class="${statusClass}">${statusText}</td>
                    <td data-label="Vencimento">${dataVencimento}</td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-success" onclick="abrirModalUsarPacote(${pacote.id}, ${pacote.servicoId}, ${pacote.clienteId})" ${pacote.status !== 'pago' && pacote.status !== 'ativo' ? 'disabled' : ''}>
                            <span class="material-icons">event_available</span> Usar
                        </button>
                        <button class="btn-info" onclick="marcarPagoPacote(${pacote.id})" ${pacote.status !== 'pendente' ? 'disabled' : ''}>
                            <span class="material-icons">payments</span> Pago
                        </button>
                        <button class="btn-warning" onclick="editarPacote(${pacote.id})">
                            <span class="material-icons">edit</span> Editar
                        </button>
                        <button class="btn-danger" onclick="excluirPacote(${pacote.id})">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function addPacote() {
            const clienteId = document.getElementById('pacote-cliente-id').value;
            const servicoId = document.getElementById('pacote-servico-id').value;
            const dataInicio = document.getElementById('pacote-data-inicio').value;
            
            const servico = appData.servicos.find(s => s.id == servicoId);
            if (!servico) return;
            
            // Calcular data de vencimento (3 meses a partir da data de início)
            const dataVencimento = new Date(dataInicio);
            dataVencimento.setMonth(dataVencimento.getMonth() + 3);
            
            const novoPacote = {
                id: Date.now(),
                clienteId: parseInt(clienteId),
                servicoId: parseInt(servicoId),
                dataInicio,
                dataVencimento: dataVencimento.toISOString().split('T')[0],
                sessoesUsadas: 0,
                status: 'pendente', // pendente, pago, ativo, finalizado
                historicoUso: [],
                dataCriacao: new Date().toISOString()
            };
            
            appData.pacotes.push(novoPacote);
            saveAppData();
            
            // Limpar formulário
            document.getElementById('pacote-inicio-form').reset();
            document.getElementById('pacote-data-inicio').value = new Date().toISOString().split('T')[0];
            
            // Recarregar lista
            loadPacotesAtivos();
            
            showNotification('Pacote iniciado com sucesso!', 'success');
        }

        function marcarPagoPacote(id) {
            const pacote = appData.pacotes.find(p => p.id === id);
            if (!pacote) return;
            
            pacote.status = 'pago';
            saveAppData();
            loadPacotesAtivos();
            
            showNotification('Pacote marcado como pago!', 'success');
        }

        function editarPacote(id) {
            // Implementar edição de pacote se necessário
            showNotification('Funcionalidade de edição em desenvolvimento', 'info');
        }

        function excluirPacote(id) {
            if (confirm('Tem certeza que deseja excluir este pacote?')) {
                appData.pacotes = appData.pacotes.filter(p => p.id !== id);
                saveAppData();
                loadPacotesAtivos();
                showNotification('Pacote excluído com sucesso!', 'success');
            }
        }

        function usarPacote() {
            const pacoteId = parseInt(document.getElementById('modal-pacote-id').value);
            const servicoId = parseInt(document.getElementById('modal-pacote-servico-id').value);
            const clienteId = parseInt(document.getElementById('modal-pacote-cliente-id').value);
            const data = document.getElementById('modal-pacote-data').value;
            const hora = document.getElementById('modal-pacote-hora').value;
            const horaFim = document.getElementById('modal-pacote-hora-fim').value;
            const procedimento = document.getElementById('modal-pacote-procedimento').value;
            const outroProcedimento = document.getElementById('modal-pacote-outro').value;
            const observacoes = document.getElementById('modal-pacote-observacoes').value;
            
            const pacote = appData.pacotes.find(p => p.id === pacoteId);
            const servico = appData.servicos.find(s => s.id == servicoId);
            const cliente = appData.clientes.find(c => c.id == clienteId);
            
            if (!pacote || !servico || !cliente) {
                showNotification('Erro ao processar uso do pacote!', 'error');
                return;
            }
            
            // Determinar quantidade de procedimentos usados
            let quantidade = 1;
            if (procedimento === 'Pés e Mãos') {
                quantidade = 2;
            } else if (procedimento === 'Outro') {
                // Para "Outro", usar 1 procedimento por padrão
                quantidade = 1;
            }
            
            // Verificar se ainda há sessões disponíveis
            if (pacote.sessoesUsadas + quantidade > servico.sessoes) {
                showNotification('Não há sessões suficientes disponíveis neste pacote!', 'error');
                return;
            }
            
            // Atualizar pacote
            pacote.sessoesUsadas += quantidade;
            pacote.status = 'ativo';
            
            // Registrar uso no histórico do pacote
            const uso = {
                id: Date.now(),
                data,
                hora,
                procedimento: procedimento === 'Outro' ? outroProcedimento : procedimento,
                quantidade,
                observacoes
            };
            
            pacote.historicoUso.push(uso);
            
            // Verificar se o pacote foi totalmente utilizado
            if (pacote.sessoesUsadas >= servico.sessoes) {
                pacote.status = 'finalizado';
            }
            
            // Adicionar ao histórico geral
            const historicoItem = {
                id: Date.now(),
                data,
                hora,
                clienteId,
                clienteNome: cliente.nome,
                servicoId,
                servicoNome: servico.nome,
                valor: 0, // Já foi pago no pacote
                tipo: 'pacote',
                status: 'realizado',
                procedimento: procedimento === 'Outro' ? outroProcedimento : procedimento,
                dataRegistro: new Date().toISOString()
            };
            
            appData.historico.push(historicoItem);
            
            saveAppData();
            
            // Fechar modal
            document.getElementById('modal-usar-pacote').style.display = 'none';
            
            // Recarregar listas
            loadPacotesAtivos();
            loadHistorico();
            loadResumoLucros();
            loadVisaoDiaria();
            
            showNotification('Uso do pacote registrado com sucesso!', 'success');
        }

        // =============================================
        // FUNÇÕES DE VISÃO DIÁRIA
        // =============================================
        function loadVisaoDiaria() {
            const tbody = document.getElementById('corpo-visao-diaria');
            const dataSelecionada = document.getElementById('filtro-data-visao').value;
            
            if (!dataSelecionada) {
                tbody.innerHTML = '<tr><td colspan="2" style="text-align: center;">Selecione uma data para visualizar a agenda</td></tr>';
                return;
            }
            
            // Filtrar agendamentos para a data selecionada
            const agendamentosDoDia = appData.agendamentos.filter(a => a.data === dataSelecionada);
            const hoje = new Date().toISOString().split('T')[0];
            const dataSelecionadaObj = new Date(dataSelecionada);
            
            // Gerar horários do dia (das 08:00 às 20:00)
            let html = '';
            for (let hora = 8; hora <= 20; hora++) {
                const horaFormatada = hora.toString().padStart(2, '0') + ':00';
                const horaFimFormatada = (hora + 1).toString().padStart(2, '0') + ':00';
                
                // Verificar se há agendamento neste horário
                const agendamentoNoHorario = agendamentosDoDia.find(a => a.hora === horaFormatada);
                
                let conteudoCelula = '';
                let classeCelula = 'agendamento-vago';
                
                if (agendamentoNoHorario) {
                    const cliente = appData.clientes.find(c => c.id == agendamentoNoHorario.clienteId);
                    const servico = appData.servicos.find(s => s.id == agendamentoNoHorario.servicoId);
                    
                    if (cliente && servico) {
                        let statusInfo = '';
                        if (agendamentoNoHorario.status === 'realizado') {
                            statusInfo = '<br><small>✓ Realizado</small>';
                        } else if (agendamentoNoHorario.status === 'cancelado') {
                            statusInfo = '<br><small>✗ Cancelado</small>';
                        }
                        
                        conteudoCelula = `
                            <strong>${cliente.nome}</strong><br>
                            ${servico.nome}${statusInfo}
                        `;
                        classeCelula = 'agendamento-ocupado';
                    }
                } else {
                    // Verificar se é um horário vencido (data no passado)
                    if (dataSelecionada < hoje) {
                        conteudoCelula = 'Vencido';
                        classeCelula = 'agendamento-vencido';
                    } else {
                        conteudoCelula = 'Horário Livre';
                        classeCelula = 'agendamento-vago';
                    }
                }
                
                html += `
                <tr>
                    <td class="horario-celula">${horaFormatada} - ${horaFimFormatada}</td>
                    <td class="${classeCelula}">${conteudoCelula}</td>
                </tr>
                `;
            }
            
            tbody.innerHTML = html;
        }

        // =============================================
        // FUNÇÕES DE HISTÓRICO E LUCROS
        // =============================================
        function loadHistorico() {
            const tbody = document.getElementById('lista-historico');
            const filtroDataInicio = document.getElementById('filtro-data-inicio').value;
            const filtroDataFim = document.getElementById('filtro-data-fim').value;
            const filtroTipoServico = document.getElementById('filtro-tipo-servico').value;
            
            // Filtrar histórico
            let historicoFiltrado = appData.historico;
            if (filtroDataInicio) {
                historicoFiltrado = historicoFiltrado.filter(item => item.data >= filtroDataInicio);
            }
            if (filtroDataFim) {
                historicoFiltrado = historicoFiltrado.filter(item => item.data <= filtroDataFim);
            }
            if (filtroTipoServico) {
                historicoFiltrado = historicoFiltrado.filter(item => item.tipo === filtroTipoServico);
            }
            
            // Ordenar por data (mais recente primeiro)
            historicoFiltrado.sort((a, b) => {
                const dataA = new Date(a.data + 'T' + a.hora);
                const dataB = new Date(b.data + 'T' + b.hora);
                return dataB - dataA;
            });
            
            // Gerar HTML da tabela
            if (historicoFiltrado.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                return;
            }
            
            let html = '';
            historicoFiltrado.forEach(item => {
                const dataFormatada = new Date(item.data).toLocaleDateString('pt-BR');
                const tipoText = item.tipo === 'avulso' ? 'Avulso' : 'Pacote';
                const statusText = item.status === 'realizado' ? 'Realizado' : 'Cancelado';
                
                html += `
                <tr>
                    <td data-label="Data">${dataFormatada}</td>
                    <td data-label="Horário">${item.hora}</td>
                    <td data-label="Cliente">${item.clienteNome}</td>
                    <td data-label="Serviço">${item.servicoNome} ${item.procedimento ? '- ' + item.procedimento : ''}</td>
                    <td data-label="Valor">R$ ${item.valor.toFixed(2)}</td>
                    <td data-label="Tipo">${tipoText}</td>
                    <td data-label="Status">${statusText}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function loadResumoLucros() {
            const container = document.getElementById('resumo-mensal-lucros');
            const filtroMes = document.getElementById('filtro-mes-resumo').value;
            
            // Se não há filtro, mostrar acumulado de todos os meses
            if (!filtroMes) {
                mostrarResumoAcumulado();
                return;
            }
            
            // Filtrar histórico pelo mês selecionado
            const [ano, mes] = filtroMes.split('-');
            const historicoFiltrado = appData.historico.filter(item => {
                const [itemAno, itemMes] = item.data.split('-');
                return itemAno === ano && itemMes === mes && item.status === 'realizado';
            });
            
            // Calcular totais
            const totalAvulso = historicoFiltrado
                .filter(item => item.tipo === 'avulso')
                .reduce((sum, item) => sum + item.valor, 0);
                
            const totalPacote = historicoFiltrado
                .filter(item => item.tipo === 'pacote')
                .reduce((sum, item) => sum + item.valor, 0);
                
            const totalGeral = totalAvulso + totalPacote;
            
            // Formatar nome do mês
            const meses = [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            const nomeMes = meses[parseInt(mes) - 1];
            
            // Gerar HTML do resumo
            const html = `
                <h3>Resumo de Lucros - ${nomeMes} de ${ano}</h3>
                <div class="card" style="background: linear-gradient(135deg, var(--success-color) 0%, #4caf50 100%); color: white; text-align: center;">
                    <h2 style="margin: 0; font-size: 2rem;">Total: R$ ${totalGeral.toFixed(2)}</h2>
                </div>
                
                <div class="form-row">
                    <div class="card" style="flex: 1; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white;">
                        <h3>Serviços Avulsos</h3>
                        <p style="font-size: 1.5rem; margin: 0;">R$ ${totalAvulso.toFixed(2)}</p>
                    </div>
                    <div class="card" style="flex: 1; background: linear-gradient(135deg, var(--info-color) 0%, #0288d1 100%); color: white;">
                        <h3>Pacotes</h3>
                        <p style="font-size: 1.5rem; margin: 0;">R$ ${totalPacote.toFixed(2)}</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Detalhamento por Serviço</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Serviço</th>
                                <th>Quantidade</th>
                                <th>Valor Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${gerarDetalhamentoServicos(historicoFiltrado)}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function mostrarResumoAcumulado() {
            const container = document.getElementById('resumo-mensal-lucros');
            
            // Calcular totais de todos os meses
            const historicoRealizado = appData.historico.filter(item => item.status === 'realizado');
            
            const totalAvulso = historicoRealizado
                .filter(item => item.tipo === 'avulso')
                .reduce((sum, item) => sum + item.valor, 0);
                
            const totalPacote = historicoRealizado
                .filter(item => item.tipo === 'pacote')
                .reduce((sum, item) => sum + item.valor, 0);
                
            const totalGeral = totalAvulso + totalPacote;
            
            // Gerar HTML do resumo acumulado
            const html = `
                <h3>Resumo Acumulado de Lucros</h3>
                <div class="card" style="background: linear-gradient(135deg, var(--success-color) 0%, #4caf50 100%); color: white; text-align: center;">
                    <h2 style="margin: 0; font-size: 2rem;">Total Acumulado: R$ ${totalGeral.toFixed(2)}</h2>
                </div>
                
                <div class="form-row">
                    <div class="card" style="flex: 1; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white;">
                        <h3>Serviços Avulsos</h3>
                        <p style="font-size: 1.5rem; margin: 0;">R$ ${totalAvulso.toFixed(2)}</p>
                    </div>
                    <div class="card" style="flex: 1; background: linear-gradient(135deg, var(--info-color) 0%, #0288d1 100%); color: white;">
                        <h3>Pacotes</h3>
                        <p style="font-size: 1.5rem; margin: 0;">R$ ${totalPacote.toFixed(2)}</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Resumo por Mês</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mês/Ano</th>
                                <th>Serviços Avulsos</th>
                                <th>Pacotes</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${gerarResumoMensal()}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function gerarDetalhamentoServicos(historico) {
            // Agrupar por serviço
            const servicosMap = new Map();
            
            historico.forEach(item => {
                const chave = item.servicoNome + (item.procedimento ? ' - ' + item.procedimento : '');
                if (!servicosMap.has(chave)) {
                    servicosMap.set(chave, {
                        nome: chave,
                        quantidade: 0,
                        valorTotal: 0
                    });
                }
                
                const servico = servicosMap.get(chave);
                servico.quantidade += 1;
                servico.valorTotal += item.valor;
            });
            
            // Gerar linhas da tabela
            let html = '';
            servicosMap.forEach(servico => {
                html += `
                <tr>
                    <td>${servico.nome}</td>
                    <td>${servico.quantidade}</td>
                    <td>R$ ${servico.valorTotal.toFixed(2)}</td>
                </tr>
                `;
            });
            
            if (html === '') {
                html = '<tr><td colspan="3" style="text-align: center;">Nenhum serviço realizado no período</td></tr>';
            }
            
            return html;
        }

        function gerarResumoMensal() {
            // Agrupar por mês/ano
            const mesesMap = new Map();
            
            appData.historico
                .filter(item => item.status === 'realizado')
                .forEach(item => {
                    const [ano, mes] = item.data.split('-');
                    const chave = `${mes}/${ano}`;
                    const nomeMes = new Date(item.data).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                    
                    if (!mesesMap.has(chave)) {
                        mesesMap.set(chave, {
                            nome: nomeMes,
                            avulso: 0,
                            pacote: 0,
                            total: 0
                        });
                    }
                    
                    const mesData = mesesMap.get(chave);
                    if (item.tipo === 'avulso') {
                        mesData.avulso += item.valor;
                    } else {
                        mesData.pacote += item.valor;
                    }
                    mesData.total = mesData.avulso + mesData.pacote;
                });
            
            // Ordenar por data (mais recente primeiro)
            const mesesArray = Array.from(mesesMap.entries())
                .sort((a, b) => {
                    const [mesA, anoA] = a[0].split('/');
                    const [mesB, anoB] = b[0].split('/');
                    return new Date(anoB, mesB - 1) - new Date(anoA, mesA - 1);
                });
            
            // Gerar linhas da tabela
            let html = '';
            mesesArray.forEach(([chave, mesData]) => {
                html += `
                <tr>
                    <td>${mesData.nome}</td>
                    <td>R$ ${mesData.avulso.toFixed(2)}</td>
                    <td>R$ ${mesData.pacote.toFixed(2)}</td>
                    <td>R$ ${mesData.total.toFixed(2)}</td>
                </tr>
                `;
            });
            
            if (html === '') {
                html = '<tr><td colspan="4" style="text-align: center;">Nenhum serviço realizado</td></tr>';
            }
            
            return html;
        }

        // =============================================
        // FUNÇÕES DE ABAS
        // =============================================
        function showAgendaTab(tabName, event) {
            // Remover classe active de todos os botões de aba
            const tabButtons = document.querySelectorAll('#agenda-section .tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Adicionar classe active ao botão clicado
            event.target.classList.add('active');
            
            // Esconder todos os painéis de aba
            const tabPanes = document.querySelectorAll('#agenda-section .tab-pane');
            tabPanes.forEach(pane => pane.classList.remove('active'));
            
            // Mostrar o painel correspondente
            document.getElementById(tabName + '-pane').classList.add('active');
        }

        function showHistoricoTab(tabName, event) {
            // Remover classe active de todos os botões de aba
            const tabButtons = document.querySelectorAll('#historico-section .tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Adicionar classe active ao botão clicado
            event.target.classList.add('active');
            
            // Esconder todos os painéis de aba
            const tabPanes = document.querySelectorAll('#historico-section .tab-pane');
            tabPanes.forEach(pane => pane.classList.remove('active'));
            
            // Mostrar o painel correspondente
            document.getElementById(tabName + '-pane').classList.add('active');
        }

        // =============================================
        // FUNÇÕES DE RESPONSIVIDADE
        // =============================================
        function setupResponsiveTables() {
            // Esta função será chamada no carregamento e no redimensionamento
            function makeTablesResponsive() {
                const tables = document.querySelectorAll('.data-table');
                
                tables.forEach(table => {
                    const headers = [];
                    const thead = table.querySelector('thead');
                    const tbody = table.querySelector('tbody');
                    
                    if (!thead) return;
                    
                    // Coletar cabeçalhos
                    const headerCells = thead.querySelectorAll('th');
                    headerCells.forEach(cell => {
                        headers.push(cell.textContent);
                    });
                    
                    // Aplicar data-label às células do corpo
                    const rows = tbody.querySelectorAll('tr');
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        cells.forEach((cell, index) => {
                            if (headers[index]) {
                                cell.setAttribute('data-label', headers[index]);
                            }
                        });
                    });
                });
            }
            
            // Executar na inicialização
            makeTablesResponsive();
            
            // Executar quando a janela for redimensionada
            window.addEventListener('resize', makeTablesResponsive);
        }

        // =============================================
        // FUNÇÃO DE NOTIFICAÇÃO
        // =============================================
        function showNotification(message, type) {
            const notification = document.getElementById('notification-bar');
            notification.textContent = message;
            notification.className = '';
            notification.classList.add(type);
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // =============================================
        // INICIALIZAÇÃO DE DADOS DE EXEMPLO (APENAS PARA DEMONSTRAÇÃO)
        // =============================================
        function initializeSampleData() {
            // Verificar se já existem dados
            if (appData.clientes.length > 0) return;
            
            // Clientes de exemplo
            appData.clientes = [
                {
                    id: 1,
                    nome: "Maria Silva",
                    telefone: "(11) 99999-1234",
                    email: "maria.silva@email.com",
                    aniversario: "1985-03-15",
                    observacoes: "Cliente preferencial",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 2,
                    nome: "Joana Santos",
                    telefone: "(11) 98888-5678",
                    email: "joana.santos@email.com",
                    aniversario: "1990-07-22",
                    observacoes: "Gosta de esmalte vermelho",
                    dataCadastro: new Date().toISOString()
                }
            ];
            
            // Serviços de exemplo
            appData.servicos = [
                {
                    id: 1,
                    nome: "Manicure Simples",
                    valor: 25.00,
                    duracao: 30,
                    tipo: "avulso",
                    sessoes: 1,
                    descricao: "Corte, lixamento e esmaltação das unhas das mãos",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 2,
                    nome: "Pedicure Completa",
                    valor: 35.00,
                    duracao: 45,
                    tipo: "avulso",
                    sessoes: 1,
                    descricao: "Corte, lixamento, cutículas, hidratação e esmaltação dos pés",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 3,
                    nome: "Pacote Mensal Mãos e Pés",
                    valor: 200.00,
                    duracao: 60,
                    tipo: "pacote",
                    sessoes: 8,
                    descricao: "Pacote com 4 sessões de mãos e 4 sessões de pés por mês",
                    dataCadastro: new Date().toISOString()
                }
            ];
            
            saveAppData();
        }

        // Inicializar dados de exemplo
        initializeSampleData();
    </script>
</body>
</html>
