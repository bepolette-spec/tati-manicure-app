<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tati Manicure - Gerenciamento de Agendamentos</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff8c6b; /* Cor de Destaque (Salmão/Coral) */
            --secondary-color: #6c757d; /* Cinza para secundários */
            --background-color: #f4f7f6; /* Fundo Suave */
            --sidebar-bg: #ffffff;
            --sidebar-hover-bg: #fff0eb; /* Fundo mais claro para hover */
            --text-color: #343a40; /* Texto Principal (Escuro) */
            --success-color: #28a745;
            --info-color: #17a2b8;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --border-color: #e9ecef;
            --shadow-color: rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
        }

        /* Estrutura do App */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            background-color: var(--primary-color);
            min-height: 100vh;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23ffffff" opacity="0.1" d="M30,20 L70,20 L80,40 L70,60 L30,60 L20,40 Z M35,30 C37,30 38,31 38,33 C38,35 37,36 35,36 C33,36 32,35 32,33 C32,31 33,30 35,30 Z M45,30 C47,30 48,31 48,33 C48,35 47,36 45,36 C43,36 42,35 42,33 C42,31 43,30 45,30 Z M55,30 C57,30 58,31 58,33 C58,35 57,36 55,36 C53,36 52,35 52,33 C52,31 53,30 55,30 Z M65,30 C67,30 68,31 68,33 C68,35 67,36 65,36 C63,36 62,35 62,33 C62,31 63,30 65,30 Z M40,45 C42,45 43,46 43,48 C43,50 42,51 40,51 C38,51 37,50 37,48 C37,46 38,45 40,45 Z M50,45 C52,45 53,46 53,48 C53,50 52,51 50,51 C48,51 47,50 47,48 C47,46 48,45 50,45 Z M60,45 C62,45 63,46 63,48 C63,50 62,51 60,51 C58,51 57,50 57,48 C57,46 58,45 60,45 Z"/></svg>');
            background-size: 200px;
        }

        .login-card {
            background: var(--sidebar-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .login-card h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .login-icon {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        #app-container {
            display: none; /* Escondido por padrão, mostrado após o login */
            width: 100%;
            display: flex;
        }

        /* Barra Lateral (Sidebar) */
        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            box-shadow: 2px 0 5px var(--shadow-color);
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            flex-shrink: 0;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
            font-size: 1.6rem;
            font-weight: bold;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            text-decoration: none;
            color: var(--text-color);
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
        }

        .sidebar ul li a:hover,
        .sidebar ul li a.active {
            background-color: var(--sidebar-hover-bg);
            color: var(--primary-color);
        }

        .sidebar ul li a .material-icons {
            margin-right: 10px;
            font-size: 20px;
        }

        .user-info {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .user-info p {
            margin: 0 0 10px 0;
            font-weight: bold;
        }

        /* Conteúdo Principal */
        .main-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .content-section {
            display: none;
            padding: 20px;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-header h2 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.5rem;
        }
        
        /* Novas cores para Status de Pacote e Histórico */
        .status-package-paid {
             color: var(--success-color);
             font-weight: bold;
        }
        .status-package-pending {
            color: var(--warning-color);
            font-weight: bold;
        }
        .status-package-active {
            color: var(--primary-color);
            font-weight: bold;
        }
        .status-package-finalized {
            color: var(--danger-color);
            font-weight: bold;
        }

        /* Cartão (Card) */
        .card {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            margin-bottom: 20px;
        }
        
        /* NOVO V6: Abas dentro de uma seção */
        .tab-menu {
             display: flex;
             border-bottom: 2px solid var(--border-color);
             margin-bottom: 20px;
        }
        .tab-menu button {
             padding: 10px 20px;
             border: none;
             background: transparent;
             cursor: pointer;
             font-size: 1rem;
             color: var(--secondary-color);
             border-bottom: 2px solid transparent;
             transition: border-color 0.2s, color 0.2s;
             font-weight: bold;
        }
        .tab-menu button.active {
             color: var(--primary-color);
             border-bottom: 2px solid var(--primary-color);
        }
        .tab-content {
             padding-top: 10px;
        }
        .tab-pane {
             display: none;
        }
        .tab-pane.active {
             display: block;
        }

        /* Formulários */
        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row > div {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        /* Datalist input */
        input[list] {
            /* Estilo para garantir que o input datalist se pareça com um campo normal */
            background-image: none;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        textarea {
            resize: vertical;
        }

        /* Botões */
        button, .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s, opacity 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #e57a5e;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: var(--text-color);
        }

        .btn-warning:hover {
            background-color: #ffb547;
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table thead tr {
            background-color: var(--primary-color);
            color: white;
            text-align: left;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tbody tr:hover {
            background-color: var(--sidebar-hover-bg);
        }

        .data-table td.action-buttons button {
            margin-right: 5px;
            padding: 6px 8px;
        }

        .data-table td.action-buttons {
            white-space: nowrap;
        }

        /* Notificação */
        #notification-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            transform: translateY(-20px);
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        #notification-bar.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        #notification-bar.success { background-color: var(--success-color); }
        #notification-bar.error { background-color: var(--danger-color); }
        #notification-bar.info { background-color: var(--info-color); }

        /* Utilitários */
        .flex-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input, .input-group select {
            flex-grow: 1;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 20px;
        }
        .filter-row > div {
            flex: 1;
        }
        .filter-row button {
            flex-grow: 0;
            flex-shrink: 0;
            padding: 9px 15px; /* Ajuste para alinhar com o input */
        }
        
        /* NOVO V6: Estilos para a Tabela de Visão Diária */
        #tabela-visao-diaria {
             border: 1px solid var(--border-color);
             margin-top: 0;
        }
        #tabela-visao-diaria thead tr {
             background-color: var(--secondary-color);
        }
        #tabela-visao-diaria td {
             height: 40px; /* Altura padrão para cada intervalo de 30 min */
             font-size: 0.9rem;
             vertical-align: top;
        }
        .horario-celula {
             width: 80px;
             font-weight: bold;
             background-color: var(--sidebar-hover-bg);
             color: var(--text-color);
             text-align: center;
             vertical-align: middle !important;
             border-right: 1px solid var(--border-color);
        }
        .agendamento-vago {
             background-color: #f7fff7; /* Verde clarinho */
             color: var(--success-color);
             font-weight: bold;
             font-style: italic;
             text-align: center;
             line-height: 40px;
        }
        .agendamento-ocupado {
             background-color: #fff0eb; /* Fundo do hover de sidebar, suave */
             color: var(--text-color);
             font-weight: 500;
             padding: 5px 10px !important;
             vertical-align: middle !important;
             line-height: 1.2;
             border-left: 5px solid var(--primary-color);
             cursor: pointer;
        }
        .agendamento-ocupado strong {
             color: var(--primary-color);
             font-weight: bold;
        }
        
        /* Modal para usar pacote */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--secondary-color);
        }
        
        /* --------------------------------------------------- */
        /* RESPONSIVIDADE MOBILE (Mobile First - Portrait Mode)*/
        /* --------------------------------------------------- */
        @media (max-width: 768px) {
            
            /* Estrutura Principal */
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: 0 0 5px var(--shadow-color);
            }

            .main-content {
                padding: 15px;
            }

            #app-container {
                flex-direction: column;
            }

            /* Navegação Horizontal */
            .sidebar ul {
                display: flex;
                flex-wrap: nowrap; /* Tenta manter em uma linha, mas permite rolagem */
                overflow-x: auto;
                justify-content: flex-start;
                border-bottom: 1px solid var(--border-color);
            }

            .sidebar ul li {
                flex-shrink: 0; /* Impede que os itens encolham */
                text-align: center;
            }

            .sidebar ul li a {
                justify-content: center;
                padding: 10px;
                flex-direction: column;
                font-size: 0.75rem;
                white-space: nowrap;
            }

            .sidebar ul li a .material-icons {
                margin-right: 0;
                margin-bottom: 5px;
                font-size: 20px;
            }

            /* FIX: Botão Sair visível no celular */
            .user-info {
                display: block;
                padding: 10px 15px;
                border-top: none; 
                text-align: center; 
            }

            .user-info p {
                display: none; /* Esconde o texto "Olá, Tati!" para economizar espaço */
            }

            .user-info button {
                width: 100%;
                margin-top: 10px; 
                font-size: 0.9rem;
            }
            
            /* 1. Correção de Formulários e Filtros (Empilhamento) */
            .form-row, .filter-row {
                flex-direction: column;
                gap: 0; /* Remove gap quando empilha */
            }

            .form-row > div, 
            .filter-row > div {
                flex: 0 0 100% !important; /* Força largura total */
                width: 100%;
            }
            
            /* Ajusta margem para inputs empilhados */
            .form-group, .filter-row > div {
                margin-bottom: 10px;
            }
            
            .filter-row button {
                width: 100%;
                margin-top: 5px; 
                padding: 10px 15px !important;
            }
            
            /* V6: Ajuste para a Tabela de Visão Diária */
            .table-responsive {
                 overflow-x: auto;
            }
            #tabela-visao-diaria {
                 width: 100%;
                 min-width: 300px; /* Garante que não fique muito esmagada */
            }
            #tabela-visao-diaria td {
                 padding: 5px 10px !important;
            }

            /* 2. Correção de Tabelas (Cartão-like View) */
            .data-table, .data-table tbody, .data-table td, .data-table tr {
                display: block; /* Força elementos da tabela a empilhar */
            }

            .data-table thead {
                display: none; /* Esconde o cabeçalho original */
            }

            .data-table tr {
                border: 1px solid var(--border-color);
                margin-bottom: 15px;
                border-radius: 8px;
                box-shadow: 0 1px 3px var(--shadow-color);
                padding: 10px;
            }

            .data-table td {
                border: none;
                position: relative;
                padding-left: 50% !important; /* Espaço para o rótulo */
                text-align: right; /* Alinha o valor à direita */
                white-space: normal; /* Permite quebras de linha */
                min-height: 40px;
            }

            /* Rótulo customizado (que usa o data-label do JS) */
            .data-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%; 
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: var(--primary-color);
            }
            
            /* FIX V6: Organização dos botões de ação em mobile */
            /* Garante que o rótulo "Ações" não sobreponha o primeiro botão */
            .data-table td.action-buttons {
                text-align: left;
                padding-left: 10px !important;
                display: flex; 
                flex-direction: column; /* Empilha os botões */
                gap: 5px;
            }
            
            .data-table td.action-buttons::before {
                content: "Ações";
                width: 100%; 
                margin-bottom: 5px;
                display: block;
            }
            
            .data-table td.action-buttons button {
                margin: 0;
                width: 100%; /* Ocupa a largura toda */
                max-width: 100%;
                box-sizing: border-box;
                font-size: 0.9rem; 
                padding: 8px 5px;
            }
            
            /* Modal em mobile */
            .modal-content {
                width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div id="notification-bar"></div>

    <!-- Modal para usar pacote -->
    <div id="modal-usar-pacote" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agendar Uso de Pacote</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="form-usar-pacote">
                <input type="hidden" id="modal-pacote-id">
                <input type="hidden" id="modal-pacote-servico-id">
                <input type="hidden" id="modal-pacote-cliente-id">
                
                <div class="form-group">
                    <label for="modal-pacote-data">Data</label>
                    <input type="date" id="modal-pacote-data" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modal-pacote-hora">Hora Início</label>
                        <input type="time" id="modal-pacote-hora" required>
                    </div>
                    <div class="form-group">
                        <label for="modal-pacote-hora-fim">Hora Fim</label>
                        <input type="time" id="modal-pacote-hora-fim" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="modal-pacote-observacoes">Observações</label>
                    <textarea id="modal-pacote-observacoes" rows="2"></textarea>
                </div>
                
                <div class="flex-container">
                    <button type="submit" class="btn-success">
                        <span class="material-icons">check_circle</span> Confirmar Uso
                    </button>
                    <button type="button" class="btn-secondary" id="cancelar-usar-pacote">
                        <span class="material-icons">cancel</span> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="login-container">
        <div class="login-card">
            <div class="login-icon">
                <span class="material-icons">spa</span>
            </div>
            <h1>Tati Manicure - Acesso</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="loginSenha">Senha de Acesso</label>
                    <input type="password" id="loginSenha" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">
                    <span class="material-icons">login</span> Entrar
                </button>
            </form>
        </div>
    </div>

    <datalist id="clientes-datalist"></datalist>

    <div id="app-container">
        
        <aside class="sidebar">
            <div class="logo">TATI MANICURE APP</div>
            
            <ul>
                <li><a href="#" data-section="agenda" class="active"><span class="material-icons">calendar_today</span> Agenda</a></li>
                <li><a href="#" data-section="clientes"><span class="material-icons">people</span> Clientes</a></li>
                <li><a href="#" data-section="servicos"><span class="material-icons">local_offer</span> Serviços</a></li>
                <li><a href="#" data-section="historico"><span class="material-icons">history</span> Histórico/Lucros</a></li>
            </ul>

            <div class="user-info">
                <p id="userInfo">Olá, Tati!</p>
                <button id="logout-button" class="btn-danger" style="width: 100%;">
                    <span class="material-icons">logout</span> Sair
                </button>
            </div>
        </aside>

        <main class="main-content">

            <div id="agenda-section" class="content-section active">
                
                <div class="tab-menu">
                     <button class="tab-button active" onclick="showAgendaTab('pacotes-ativos', event)">Pacotes Ativos</button>
                     <button class="tab-button" onclick="showAgendaTab('novo-agendamento', event)">Novo Agendamento</button>
                     <button class="tab-button" onclick="showAgendaTab('lista-agendamentos', event)">Lista Agendamentos</button>
                     <button class="tab-button" onclick="showAgendaTab('visao-diaria', event)">Visão Diária</button>
                </div>
                
                <div class="tab-content">
                    
                    <div id="pacotes-ativos-pane" class="tab-pane active">
                         <div class="section-header"><h2>Gerenciamento de Pacotes Ativos</h2></div>
                         <div class="card">
                            <form id="pacote-inicio-form">
                                <h3>Iniciar Novo Pacote de Serviços</h3>
                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label for="pacote-cliente-id">Cliente</label>
                                        <select id="pacote-cliente-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 2;">
                                        <label for="pacote-servico-id">Pacote (Serviços marcados como Pacote)</label>
                                        <select id="pacote-servico-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label for="pacote-data-inicio">Data Início (Geralmente Hoje)</label>
                                        <input type="date" id="pacote-data-inicio" required>
                                    </div>
                                </div>

                                <div class="flex-container">
                                    <button type="submit" class="btn-primary">
                                        <span class="material-icons">add_box</span> Iniciar/Vender Pacote
                                    </button>
                                </div>
                            </form>
                            
                            <hr style="margin: 20px 0;">

                            <h3>Pacotes Ativos e Utilização</h3>
                            <div style="max-height: 500px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 20%;">Cliente</th>
                                            <th style="width: 25%;">Pacote (Total/Usado)</th>
                                            <th style="width: 15%;">Pagamento</th>
                                            <th style="width: 15%;">Vencimento</th>
                                            <th style="width: 200px;">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-pacotes-ativos">
                                        <tr><td colspan="5" style="text-align: center;">Carregando pacotes ativos...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div id="novo-agendamento-pane" class="tab-pane">
                        <div class="section-header"><h2>Agendamento de Serviços Individuais (Não-Pacote)</h2></div>
                         <div class="card">
                            <form id="agendamento-form">
                                <input type="hidden" id="agendamento-id">
                                
                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label for="agenda-cliente-id">Cliente</label>
                                        <select id="agenda-cliente-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 2;">
                                        <label for="agenda-servico-id">Serviço Individual/Promoção</label>
                                        <select id="agenda-servico-id" required></select>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label for="agenda-data">Data</label>
                                        <input type="date" id="agenda-data" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                     <div class="form-group" style="flex: 1;">
                                        <label for="agenda-hora">Hora Início</label>
                                        <input type="time" id="agenda-hora" required>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label for="agenda-hora-fim">Hora Fim</label>
                                        <input type="time" id="agenda-hora-fim" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="agenda-observacoes">Observações</label>
                                    <textarea id="agenda-observacoes" rows="2"></textarea>
                                </div>

                                <div class="flex-container">
                                    <div>
                                        <button type="submit" class="btn-success" id="btn-salvar-agendamento">
                                            <span class="material-icons">save</span> Salvar Agendamento
                                        </button>
                                        <button type="button" class="btn-secondary" onclick="resetAgendamentoForm()">
                                            <span class="material-icons">refresh</span> Limpar
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div id="lista-agendamentos-pane" class="tab-pane">
                         <div class="section-header">
                             <h3>Próximos Agendamentos Individuais (Ativos)</h3>
                         </div>
                         <div class="card">
                            <div class="filter-row">
                                <div style="flex-grow: 1.5;">
                                    <label for="filtro-agenda-data">Filtrar por Data</label>
                                    <input type="date" id="filtro-agenda-data" onchange="carregarAgendamentos()">
                                </div>
                                <div style="flex-grow: 3;">
                                    <label for="filtro-agenda-cliente">Filtrar por Cliente (Digite ou Selecione)</label>
                                    <input type="text" id="filtro-agenda-cliente" list="clientes-datalist" placeholder="Digite o nome do cliente..." onkeyup="filtrarAgendamentos()">
                                </div>
                                <button class="btn-secondary" onclick="resetFiltroAgenda()"><span class="material-icons">refresh</span> Resetar Filtro</button>
                            </div>

                            <div style="max-height: 500px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 15%;">Data/Hora</th>
                                            <th style="width: 25%;">Cliente</th>
                                            <th style="width: 25%;">Serviço</th>
                                            <th>Status</th>
                                            <th style="width: 150px;">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-agendamentos">
                                        <tr><td colspan="5" style="text-align: center;">Carregando agendamentos...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="visao-diaria-pane" class="tab-pane">
                        <div class="section-header">
                            <h2>Visão Diária da Agenda</h2>
                        </div>
                        <div class="card">
                            <div class="filter-row">
                                <div style="flex-grow: 1;">
                                    <label for="filtro-visao-diaria-data">Selecione a Data</label>
                                    <input type="date" id="filtro-visao-diaria-data" onchange="renderizarVisaoDiaria()">
                                </div>
                                <button class="btn-secondary" onclick="renderizarVisaoDiaria(true)"><span class="material-icons">today</span> Ver Hoje</button>
                            </div>

                            <div class="table-responsive">
                                <table class="data-table" id="tabela-visao-diaria">
                                    <thead>
                                        <tr>
                                            <th style="width: 100px;">Horário</th>
                                            <th>Detalhes do Agendamento</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-visao-diaria">
                                        <tr><td colspan="2" style="text-align: center;">Selecione uma data para visualizar.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div id="clientes-section" class="content-section">
                <div class="section-header"><h2>Cadastro de Clientes</h2></div>
                <div class="card">
                    <form id="cliente-form">
                        <input type="hidden" id="cliente-id">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="cliente-nome">Nome Completo</label>
                                <input type="text" id="cliente-nome" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="cliente-telefone">Telefone</label>
                                <input type="tel" id="cliente-telefone">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="cliente-email">E-mail</label>
                                <input type="email" id="cliente-email">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="cliente-aniversario">Data de Nascimento</label>
                                <input type="date" id="cliente-aniversario">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cliente-observacoes">Observações</label>
                            <textarea id="cliente-observacoes" rows="3"></textarea>
                        </div>
                        <div class="flex-container">
                            <div>
                                <button type="submit" class="btn-success" id="btn-salvar-cliente">
                                    <span class="material-icons">save</span> Salvar Cliente
                                </button>
                                <button type="button" class="btn-secondary" onclick="resetClienteForm()">
                                    <span class="material-icons">refresh</span> Limpar
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="section-header"><h3>Lista de Clientes</h3></div>
                <div class="card">
                    <div class="filter-row">
                        <div style="flex-grow: 1;">
                            <label for="filtro-cliente-nome">Filtrar por Nome</label>
                            <input type="text" id="filtro-cliente-nome" placeholder="Digite o nome do cliente..." onkeyup="filtrarClientes()">
                        </div>
                        <button class="btn-secondary" onclick="resetFiltroCliente()"><span class="material-icons">refresh</span> Resetar Filtro</button>
                    </div>

                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">Nome</th>
                                    <th style="width: 20%;">Telefone</th>
                                    <th style="width: 25%;">E-mail</th>
                                    <th style="width: 15%;">Nascimento</th>
                                    <th style="width: 150px;">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lista-clientes">
                                <tr><td colspan="5" style="text-align: center;">Carregando clientes...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="servicos-section" class="content-section">
                <div class="section-header"><h2>Cadastro de Serviços/Pacotes</h2></div>
                <div class="card">
                    <form id="servico-form">
                        <input type="hidden" id="servico-id">
                        <div class="form-row">
                            <div class="form-group" style="flex: 3;">
                                <label for="servico-nome">Nome do Serviço/Pacote</label>
                                <input type="text" id="servico-nome" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-preco">Preço (R$)</label>
                                <input type="number" id="servico-preco" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-duracao">Duração (minutos)</label>
                                <input type="number" id="servico-duracao" min="1" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-tipo">Tipo</label>
                                <select id="servico-tipo" required>
                                    <option value="individual">Serviço Individual</option>
                                    <option value="pacote">Pacote (Vários Serviços)</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="servico-sessoes">Sessões (se Pacote)</label>
                                <input type="number" id="servico-sessoes" min="1" value="1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="servico-descricao">Descrição</label>
                            <textarea id="servico-descricao" rows="3"></textarea>
                        </div>
                        <div class="flex-container">
                            <div>
                                <button type="submit" class="btn-success" id="btn-salvar-servico">
                                    <span class="material-icons">save</span> Salvar Serviço
                                </button>
                                <button type="button" class="btn-secondary" onclick="resetServicoForm()">
                                    <span class="material-icons">refresh</span> Limpar
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="section-header"><h3>Lista de Serviços e Pacotes</h3></div>
                <div class="card">
                    <div class="filter-row">
                        <div style="flex-grow: 1;">
                            <label for="filtro-servico-nome">Filtrar por Nome</label>
                            <input type="text" id="filtro-servico-nome" placeholder="Digite o nome do serviço..." onkeyup="filtrarServicos()">
                        </div>
                        <div style="flex-grow: 1;">
                            <label for="filtro-servico-tipo">Filtrar por Tipo</label>
                            <select id="filtro-servico-tipo" onchange="filtrarServicos()">
                                <option value="">Todos</option>
                                <option value="individual">Serviços Individuais</option>
                                <option value="pacote">Pacotes</option>
                            </select>
                        </div>
                        <button class="btn-secondary" onclick="resetFiltroServico()"><span class="material-icons">refresh</span> Resetar Filtro</button>
                    </div>

                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">Nome</th>
                                    <th style="width: 15%;">Preço</th>
                                    <th style="width: 15%;">Duração</th>
                                    <th style="width: 15%;">Tipo</th>
                                    <th style="width: 150px;">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lista-servicos">
                                <tr><td colspan="5" style="text-align: center;">Carregando serviços...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="historico-section" class="content-section">
                <div class="section-header"><h2>Histórico e Controle de Lucros</h2></div>
                <div class="card">
                    <div class="filter-row">
                        <div style="flex-grow: 1;">
                            <label for="filtro-historico-mes">Filtrar por Mês/Ano</label>
                            <input type="month" id="filtro-historico-mes" onchange="carregarHistorico()">
                        </div>
                        <button class="btn-secondary" onclick="resetFiltroHistorico()"><span class="material-icons">refresh</span> Resetar Filtro</button>
                    </div>

                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 15%;">Data</th>
                                    <th style="width: 25%;">Cliente</th>
                                    <th style="width: 25%;">Serviço</th>
                                    <th style="width: 15%;">Valor</th>
                                    <th style="width: 10%;">Status</th>
                                    <th style="width: 150px;">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lista-historico">
                                <tr><td colspan="6" style="text-align: center;">Carregando histórico...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="section-header" style="margin-top: 30px;">
                    <h3>Resumo Financeiro</h3>
                </div>
                <div class="card">
                    <div class="form-row">
                        <div class="form-group" style="flex: 1; text-align: center;">
                            <h4>Total Recebido</h4>
                            <p id="total-recebido" style="font-size: 1.5rem; color: var(--success-color); font-weight: bold;">R$ 0,00</p>
                        </div>
                        <div class="form-group" style="flex: 1; text-align: center;">
                            <h4>Total Pendente</h4>
                            <p id="total-pendente" style="font-size: 1.5rem; color: var(--warning-color); font-weight: bold;">R$ 0,00</p>
                        </div>
                        <div class="form-group" style="flex: 1; text-align: center;">
                            <h4>Total do Mês</h4>
                            <p id="total-mes" style="font-size: 1.5rem; color: var(--primary-color); font-weight: bold;">R$ 0,00</p>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // =============================================
        // CONFIGURAÇÃO E INICIALIZAÇÃO
        // =============================================
        
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCJQ8hV8V8V8V8V8V8V8V8V8V8V8V8V8V8",
            authDomain: "tati-manicure-app.firebaseapp.com",
            databaseURL: "https://tati-manicure-app-default-rtdb.firebaseio.com",
            projectId: "tati-manicure-app",
            storageBucket: "tati-manicure-app.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Inicialização do Firebase (simulação para demonstração)
        let firebaseInitialized = false;
        let database;
        
        // Inicializar Firebase (simulação)
        function initializeFirebase() {
            // Em um ambiente real, isso inicializaria o Firebase
            firebaseInitialized = true;
            console.log("Firebase inicializado (simulação)");
            
            // Carregar dados iniciais
            carregarDadosIniciais();
        }

        // =============================================
        // VARIÁVEIS GLOBAIS E ESTADO DO APP
        // =============================================
        let clientes = [];
        let servicos = [];
        let agendamentos = [];
        let pacotesAtivos = [];
        let historico = [];
        
        // =============================================
        // FUNÇÕES DE INICIALIZAÇÃO E CARREGAMENTO
        // =============================================
        
        // Carregar dados iniciais do Firebase
        function carregarDadosIniciais() {
            // Simulação de carregamento de dados
            console.log("Carregando dados iniciais...");
            
            // Carregar dados de exemplo para demonstração
            carregarDadosExemplo();
            
            // Atualizar interfaces
            atualizarSelectClientes();
            atualizarSelectServicos();
            carregarAgendamentos();
            carregarPacotesAtivos();
            carregarHistorico();
            
            // Configurar data atual nos campos de data
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('agenda-data').value = hoje;
            document.getElementById('pacote-data-inicio').value = hoje;
            document.getElementById('filtro-visao-diaria-data').value = hoje;
            
            // Configurar horários de início e fim padrão
            document.getElementById('agenda-hora').value = '09:00';
            document.getElementById('agenda-hora-fim').value = '10:00';
            
            // Configurar datalist de clientes
            atualizarDatalistClientes();
            
            // Renderizar visão diária inicial
            renderizarVisaoDiaria();
        }
        
        // Carregar dados de exemplo para demonstração
        function carregarDadosExemplo() {
            // Clientes de exemplo
            clientes = [
                { id: '1', nome: 'Maria Silva', telefone: '(11) 99999-9999', email: 'maria@email.com', aniversario: '1990-05-15', observacoes: 'Cliente fiel' },
                { id: '2', nome: 'Joana Santos', telefone: '(11) 88888-8888', email: 'joana@email.com', aniversario: '1985-10-20', observacoes: 'Gosta de esmalte vermelho' }
            ];
            
            // Serviços de exemplo
            servicos = [
                { id: '1', nome: 'Manicure Simples', preco: 25.00, duracao: 30, tipo: 'individual', sessoes: 1, descricao: 'Corte, lixa e esmaltação simples' },
                { id: '2', nome: 'Pedicure Completa', preco: 40.00, duracao: 60, tipo: 'individual', sessoes: 1, descricao: 'Pedicure completa com hidratação' },
                { id: '3', nome: 'Pacote Mensal (4 sessões)', preco: 80.00, duracao: 30, tipo: 'pacote', sessoes: 4, descricao: 'Pacote mensal com 4 sessões de manicure' }
            ];
            
            // Agendamentos de exemplo
            agendamentos = [
                { id: '1', clienteId: '1', servicoId: '1', data: new Date().toISOString().split('T')[0], hora: '09:00', horaFim: '09:30', observacoes: '', status: 'agendado' },
                { id: '2', clienteId: '2', servicoId: '2', data: new Date().toISOString().split('T')[0], hora: '10:00', horaFim: '11:00', observacoes: 'Trazer esmalte vermelho', status: 'agendado' }
            ];
            
            // Pacotes ativos de exemplo
            pacotesAtivos = [
                { id: '1', clienteId: '1', servicoId: '3', dataInicio: new Date().toISOString().split('T')[0], sessoesTotal: 4, sessoesUsadas: 0, status: 'ativo', pagamento: 'pendente' }
            ];
            
            // Histórico de exemplo
            historico = [
                { id: '1', clienteId: '1', servicoId: '1', data: '2023-10-01', valor: 25.00, status: 'pago', tipo: 'individual' },
                { id: '2', clienteId: '2', servicoId: '2', data: '2023-10-02', valor: 40.00, status: 'pago', tipo: 'individual' }
            ];
        }
        
        // =============================================
        // FUNÇÕES DE INTERFACE E NAVEGAÇÃO
        // =============================================
        
        // Alternar entre seções do app
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover classe active de todos os links
                document.querySelectorAll('.sidebar a').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Adicionar classe active ao link clicado
                this.classList.add('active');
                
                // Esconder todas as seções
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar a seção correspondente
                const sectionId = this.getAttribute('data-section') + '-section';
                document.getElementById(sectionId).classList.add('active');
            });
        });
        
        // Alternar entre abas da agenda
        function showAgendaTab(tabId, event) {
            // Remover classe active de todos os botões de aba
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Adicionar classe active ao botão clicado
            event.target.classList.add('active');
            
            // Esconder todos os painéis de aba
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Mostrar o painel correspondente
            document.getElementById(tabId + '-pane').classList.add('active');
        }
        
        // =============================================
        // FUNÇÕES DE FORMULÁRIOS E CRUD
        // =============================================
        
        // Formulário de Cliente
        document.getElementById('cliente-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const clienteId = document.getElementById('cliente-id').value;
            const clienteData = {
                nome: document.getElementById('cliente-nome').value,
                telefone: document.getElementById('cliente-telefone').value,
                email: document.getElementById('cliente-email').value,
                aniversario: document.getElementById('cliente-aniversario').value,
                observacoes: document.getElementById('cliente-observacoes').value
            };
            
            if (clienteId) {
                // Editar cliente existente
                editarCliente(clienteId, clienteData);
            } else {
                // Adicionar novo cliente
                adicionarCliente(clienteData);
            }
        });
        
        // Formulário de Serviço
        document.getElementById('servico-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const servicoId = document.getElementById('servico-id').value;
            const servicoData = {
                nome: document.getElementById('servico-nome').value,
                preco: parseFloat(document.getElementById('servico-preco').value),
                duracao: parseInt(document.getElementById('servico-duracao').value),
                tipo: document.getElementById('servico-tipo').value,
                sessoes: parseInt(document.getElementById('servico-sessoes').value) || 1,
                descricao: document.getElementById('servico-descricao').value
            };
            
            if (servicoId) {
                // Editar serviço existente
                editarServico(servicoId, servicoData);
            } else {
                // Adicionar novo serviço
                adicionarServico(servicoData);
            }
        });
        
        // Formulário de Agendamento
        document.getElementById('agendamento-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const agendamentoId = document.getElementById('agendamento-id').value;
            const agendamentoData = {
                clienteId: document.getElementById('agenda-cliente-id').value,
                servicoId: document.getElementById('agenda-servico-id').value,
                data: document.getElementById('agenda-data').value,
                hora: document.getElementById('agenda-hora').value,
                horaFim: document.getElementById('agenda-hora-fim').value,
                observacoes: document.getElementById('agenda-observacoes').value,
                status: 'agendado'
            };
            
            if (agendamentoId) {
                // Editar agendamento existente
                editarAgendamento(agendamentoId, agendamentoData);
            } else {
                // Adicionar novo agendamento
                adicionarAgendamento(agendamentoData);
            }
        });
        
        // Formulário de Pacote
        document.getElementById('pacote-inicio-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const pacoteData = {
                clienteId: document.getElementById('pacote-cliente-id').value,
                servicoId: document.getElementById('pacote-servico-id').value,
                dataInicio: document.getElementById('pacote-data-inicio').value,
                sessoesTotal: servicos.find(s => s.id === document.getElementById('pacote-servico-id').value).sessoes,
                sessoesUsadas: 0,
                status: 'ativo',
                pagamento: 'pendente'
            };
            
            adicionarPacote(pacoteData);
        });
        
        // Formulário de Usar Pacote (Modal)
        document.getElementById('form-usar-pacote').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const pacoteId = document.getElementById('modal-pacote-id').value;
            const servicoId = document.getElementById('modal-pacote-servico-id').value;
            const clienteId = document.getElementById('modal-pacote-cliente-id').value;
            
            const usoPacoteData = {
                pacoteId: pacoteId,
                clienteId: clienteId,
                servicoId: servicoId,
                data: document.getElementById('modal-pacote-data').value,
                hora: document.getElementById('modal-pacote-hora').value,
                horaFim: document.getElementById('modal-pacote-hora-fim').value,
                observacoes: document.getElementById('modal-pacote-observacoes').value,
                status: 'realizado',
                tipo: 'pacote',
                valor: 0 // Valor zero pois já foi pago no pacote
            };
            
            usarPacote(pacoteId, usoPacoteData);
        });
        
        // =============================================
        // FUNÇÕES CRUD PARA CLIENTES
        // =============================================
        
        function adicionarCliente(clienteData) {
            // Gerar ID único
            const id = 'cliente_' + Date.now();
            clienteData.id = id;
            
            // Adicionar à lista
            clientes.push(clienteData);
            
            // Atualizar interface
            atualizarListaClientes();
            atualizarSelectClientes();
            atualizarDatalistClientes();
            
            // Limpar formulário
            resetClienteForm();
            
            // Mostrar notificação
            mostrarNotificacao('Cliente adicionado com sucesso!', 'success');
        }
        
        function editarCliente(id, clienteData) {
            // Encontrar índice do cliente
            const index = clientes.findIndex(c => c.id === id);
            
            if (index !== -1) {
                // Atualizar dados
                clientes[index] = { ...clientes[index], ...clienteData };
                
                // Atualizar interface
                atualizarListaClientes();
                atualizarSelectClientes();
                atualizarDatalistClientes();
                
                // Limpar formulário
                resetClienteForm();
                
                // Mostrar notificação
                mostrarNotificacao('Cliente atualizado com sucesso!', 'success');
            }
        }
        
        function excluirCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                // Remover da lista
                clientes = clientes.filter(c => c.id !== id);
                
                // Atualizar interface
                atualizarListaClientes();
                atualizarSelectClientes();
                atualizarDatalistClientes();
                
                // Mostrar notificação
                mostrarNotificacao('Cliente excluído com sucesso!', 'success');
            }
        }
        
        function preencherFormCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            
            if (cliente) {
                document.getElementById('cliente-id').value = cliente.id;
                document.getElementById('cliente-nome').value = cliente.nome;
                document.getElementById('cliente-telefone').value = cliente.telefone || '';
                document.getElementById('cliente-email').value = cliente.email || '';
                document.getElementById('cliente-aniversario').value = cliente.aniversario || '';
                document.getElementById('cliente-observacoes').value = cliente.observacoes || '';
                
                // Rolar para o topo do formulário
                document.getElementById('clientes-section').scrollTop = 0;
            }
        }
        
        function resetClienteForm() {
            document.getElementById('cliente-form').reset();
            document.getElementById('cliente-id').value = '';
        }
        
        function atualizarListaClientes() {
            const tbody = document.getElementById('lista-clientes');
            const filtro = document.getElementById('filtro-cliente-nome').value.toLowerCase();
            
            // Filtrar clientes
            let clientesFiltrados = clientes;
            if (filtro) {
                clientesFiltrados = clientes.filter(c => 
                    c.nome.toLowerCase().includes(filtro)
                );
            }
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher tabela
            clientesFiltrados.forEach(cliente => {
                const tr = document.createElement('tr');
                
                // Adicionar data-label para responsividade
                tr.innerHTML = `
                    <td data-label="Nome">${cliente.nome}</td>
                    <td data-label="Telefone">${cliente.telefone || '-'}</td>
                    <td data-label="E-mail">${cliente.email || '-'}</td>
                    <td data-label="Nascimento">${cliente.aniversario ? formatarData(cliente.aniversario) : '-'}</td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-warning" onclick="preencherFormCliente('${cliente.id}')">
                            <span class="material-icons">edit</span> Editar
                        </button>
                        <button class="btn-danger" onclick="excluirCliente('${cliente.id}')">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Se não houver clientes, mostrar mensagem
            if (clientesFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum cliente encontrado.</td></tr>';
            }
        }
        
        function filtrarClientes() {
            atualizarListaClientes();
        }
        
        function resetFiltroCliente() {
            document.getElementById('filtro-cliente-nome').value = '';
            atualizarListaClientes();
        }
        
        function atualizarSelectClientes() {
            const selectAgenda = document.getElementById('agenda-cliente-id');
            const selectPacote = document.getElementById('pacote-cliente-id');
            
            // Limpar selects
            selectAgenda.innerHTML = '<option value="">Selecione um cliente</option>';
            selectPacote.innerHTML = '<option value="">Selecione um cliente</option>';
            
            // Preencher com clientes
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                
                selectAgenda.appendChild(option.cloneNode(true));
                selectPacote.appendChild(option);
            });
        }
        
        function atualizarDatalistClientes() {
            const datalist = document.getElementById('clientes-datalist');
            
            // Limpar datalist
            datalist.innerHTML = '';
            
            // Preencher com clientes
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.nome;
                option.setAttribute('data-id', cliente.id);
                
                datalist.appendChild(option);
            });
        }
        
        // =============================================
        // FUNÇÕES CRUD PARA SERVIÇOS
        // =============================================
        
        function adicionarServico(servicoData) {
            // Gerar ID único
            const id = 'servico_' + Date.now();
            servicoData.id = id;
            
            // Adicionar à lista
            servicos.push(servicoData);
            
            // Atualizar interface
            atualizarListaServicos();
            atualizarSelectServicos();
            
            // Limpar formulário
            resetServicoForm();
            
            // Mostrar notificação
            mostrarNotificacao('Serviço adicionado com sucesso!', 'success');
        }
        
        function editarServico(id, servicoData) {
            // Encontrar índice do serviço
            const index = servicos.findIndex(s => s.id === id);
            
            if (index !== -1) {
                // Atualizar dados
                servicos[index] = { ...servicos[index], ...servicoData };
                
                // Atualizar interface
                atualizarListaServicos();
                atualizarSelectServicos();
                
                // Limpar formulário
                resetServicoForm();
                
                // Mostrar notificação
                mostrarNotificacao('Serviço atualizado com sucesso!', 'success');
            }
        }
        
        function excluirServico(id) {
            if (confirm('Tem certeza que deseja excluir este serviço?')) {
                // Remover da lista
                servicos = servicos.filter(s => s.id !== id);
                
                // Atualizar interface
                atualizarListaServicos();
                atualizarSelectServicos();
                
                // Mostrar notificação
                mostrarNotificacao('Serviço excluído com sucesso!', 'success');
            }
        }
        
        function preencherFormServico(id) {
            const servico = servicos.find(s => s.id === id);
            
            if (servico) {
                document.getElementById('servico-id').value = servico.id;
                document.getElementById('servico-nome').value = servico.nome;
                document.getElementById('servico-preco').value = servico.preco;
                document.getElementById('servico-duracao').value = servico.duracao;
                document.getElementById('servico-tipo').value = servico.tipo;
                document.getElementById('servico-sessoes').value = servico.sessoes;
                document.getElementById('servico-descricao').value = servico.descricao || '';
                
                // Rolar para o topo do formulário
                document.getElementById('servicos-section').scrollTop = 0;
            }
        }
        
        function resetServicoForm() {
            document.getElementById('servico-form').reset();
            document.getElementById('servico-id').value = '';
            document.getElementById('servico-sessoes').value = '1';
        }
        
        function atualizarListaServicos() {
            const tbody = document.getElementById('lista-servicos');
            const filtroNome = document.getElementById('filtro-servico-nome').value.toLowerCase();
            const filtroTipo = document.getElementById('filtro-servico-tipo').value;
            
            // Filtrar serviços
            let servicosFiltrados = servicos;
            if (filtroNome) {
                servicosFiltrados = servicosFiltrados.filter(s => 
                    s.nome.toLowerCase().includes(filtroNome)
                );
            }
            if (filtroTipo) {
                servicosFiltrados = servicosFiltrados.filter(s => s.tipo === filtroTipo);
            }
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher tabela
            servicosFiltrados.forEach(servico => {
                const tr = document.createElement('tr');
                
                // Adicionar data-label para responsividade
                tr.innerHTML = `
                    <td data-label="Nome">${servico.nome}</td>
                    <td data-label="Preço">R$ ${servico.preco.toFixed(2)}</td>
                    <td data-label="Duração">${servico.duracao} min</td>
                    <td data-label="Tipo">${servico.tipo === 'individual' ? 'Individual' : 'Pacote'}</td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-warning" onclick="preencherFormServico('${servico.id}')">
                            <span class="material-icons">edit</span> Editar
                        </button>
                        <button class="btn-danger" onclick="excluirServico('${servico.id}')">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Se não houver serviços, mostrar mensagem
            if (servicosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum serviço encontrado.</td></tr>';
            }
        }
        
        function filtrarServicos() {
            atualizarListaServicos();
        }
        
        function resetFiltroServico() {
            document.getElementById('filtro-servico-nome').value = '';
            document.getElementById('filtro-servico-tipo').value = '';
            atualizarListaServicos();
        }
        
        function atualizarSelectServicos() {
            const selectAgenda = document.getElementById('agenda-servico-id');
            const selectPacote = document.getElementById('pacote-servico-id');
            
            // Limpar selects
            selectAgenda.innerHTML = '<option value="">Selecione um serviço</option>';
            selectPacote.innerHTML = '<option value="">Selecione um pacote</option>';
            
            // Preencher com serviços
            servicos.forEach(servico => {
                const option = document.createElement('option');
                option.value = servico.id;
                option.textContent = `${servico.nome} - R$ ${servico.preco.toFixed(2)}`;
                
                // Serviços individuais para agendamento
                if (servico.tipo === 'individual') {
                    selectAgenda.appendChild(option.cloneNode(true));
                }
                
                // Pacotes para seleção de pacotes
                if (servico.tipo === 'pacote') {
                    selectPacote.appendChild(option);
                }
            });
        }
        
        // =============================================
        // FUNÇÕES CRUD PARA AGENDAMENTOS
        // =============================================
        
        function adicionarAgendamento(agendamentoData) {
            // Gerar ID único
            const id = 'agendamento_' + Date.now();
            agendamentoData.id = id;
            
            // Adicionar à lista
            agendamentos.push(agendamentoData);
            
            // Atualizar interface
            carregarAgendamentos();
            renderizarVisaoDiaria();
            
            // Limpar formulário
            resetAgendamentoForm();
            
            // Mostrar notificação
            mostrarNotificacao('Agendamento realizado com sucesso!', 'success');
        }
        
        function editarAgendamento(id, agendamentoData) {
            // Encontrar índice do agendamento
            const index = agendamentos.findIndex(a => a.id === id);
            
            if (index !== -1) {
                // Atualizar dados
                agendamentos[index] = { ...agendamentos[index], ...agendamentoData };
                
                // Atualizar interface
                carregarAgendamentos();
                renderizarVisaoDiaria();
                
                // Limpar formulário
                resetAgendamentoForm();
                
                // Mostrar notificação
                mostrarNotificacao('Agendamento atualizado com sucesso!', 'success');
            }
        }
        
        function excluirAgendamento(id) {
            if (confirm('Tem certeza que deseja excluir este agendamento?')) {
                // Remover da lista
                agendamentos = agendamentos.filter(a => a.id !== id);
                
                // Atualizar interface
                carregarAgendamentos();
                renderizarVisaoDiaria();
                
                // Mostrar notificação
                mostrarNotificacao('Agendamento excluído com sucesso!', 'success');
            }
        }
        
        function finalizarAgendamento(id) {
            const agendamento = agendamentos.find(a => a.id === id);
            
            if (agendamento) {
                // Mover para histórico
                const historicoItem = {
                    id: 'historico_' + Date.now(),
                    clienteId: agendamento.clienteId,
                    servicoId: agendamento.servicoId,
                    data: agendamento.data,
                    valor: servicos.find(s => s.id === agendamento.servicoId).preco,
                    status: 'pendente',
                    tipo: 'individual'
                };
                
                historico.push(historicoItem);
                
                // Remover da lista de agendamentos
                agendamentos = agendamentos.filter(a => a.id !== id);
                
                // Atualizar interfaces
                carregarAgendamentos();
                carregarHistorico();
                renderizarVisaoDiaria();
                
                // Mostrar notificação
                mostrarNotificacao('Agendamento finalizado com sucesso!', 'success');
            }
        }
        
        function preencherFormAgendamento(id) {
            const agendamento = agendamentos.find(a => a.id === id);
            
            if (agendamento) {
                document.getElementById('agendamento-id').value = agendamento.id;
                document.getElementById('agenda-cliente-id').value = agendamento.clienteId;
                document.getElementById('agenda-servico-id').value = agendamento.servicoId;
                document.getElementById('agenda-data').value = agendamento.data;
                document.getElementById('agenda-hora').value = agendamento.hora;
                document.getElementById('agenda-hora-fim').value = agendamento.horaFim;
                document.getElementById('agenda-observacoes').value = agendamento.observacoes || '';
                
                // Mudar para a aba de novo agendamento
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                });
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });
                document.querySelector('[onclick*="novo-agendamento"]').classList.add('active');
                document.getElementById('novo-agendamento-pane').classList.add('active');
                
                // Rolar para o topo do formulário
                document.getElementById('agenda-section').scrollTop = 0;
            }
        }
        
        function resetAgendamentoForm() {
            document.getElementById('agendamento-form').reset();
            document.getElementById('agendamento-id').value = '';
            
            // Restaurar data e hora padrão
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('agenda-data').value = hoje;
            document.getElementById('agenda-hora').value = '09:00';
            document.getElementById('agenda-hora-fim').value = '10:00';
        }
        
        function carregarAgendamentos() {
            const tbody = document.getElementById('lista-agendamentos');
            const filtroData = document.getElementById('filtro-agenda-data').value;
            const filtroCliente = document.getElementById('filtro-agenda-cliente').value.toLowerCase();
            
            // Filtrar agendamentos
            let agendamentosFiltrados = agendamentos.filter(a => a.status === 'agendado');
            
            if (filtroData) {
                agendamentosFiltrados = agendamentosFiltrados.filter(a => a.data === filtroData);
            }
            
            if (filtroCliente) {
                agendamentosFiltrados = agendamentosFiltrados.filter(a => {
                    const cliente = clientes.find(c => c.id === a.clienteId);
                    return cliente && cliente.nome.toLowerCase().includes(filtroCliente);
                });
            }
            
            // Ordenar por data e hora
            agendamentosFiltrados.sort((a, b) => {
                const dataA = new Date(a.data + ' ' + a.hora);
                const dataB = new Date(b.data + ' ' + b.hora);
                return dataA - dataB;
            });
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher tabela
            agendamentosFiltrados.forEach(agendamento => {
                const cliente = clientes.find(c => c.id === agendamento.clienteId);
                const servico = servicos.find(s => s.id === agendamento.servicoId);
                
                const tr = document.createElement('tr');
                
                // Adicionar data-label para responsividade
                tr.innerHTML = `
                    <td data-label="Data/Hora">${formatarData(agendamento.data)} ${agendamento.hora}</td>
                    <td data-label="Cliente">${cliente ? cliente.nome : 'Cliente não encontrado'}</td>
                    <td data-label="Serviço">${servico ? servico.nome : 'Serviço não encontrado'}</td>
                    <td data-label="Status">
                        <span class="status-package-active">Agendado</span>
                    </td>
                    <td data-label="Ações" class="action-buttons">
                        <button class="btn-warning" onclick="preencherFormAgendamento('${agendamento.id}')">
                            <span class="material-icons">edit</span> Editar
                        </button>
                        <button class="btn-success" onclick="finalizarAgendamento('${agendamento.id}')">
                            <span class="material-icons">check_circle</span> Finalizar
                        </button>
                        <button class="btn-danger" onclick="excluirAgendamento('${agendamento.id}')">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Se não houver agendamentos, mostrar mensagem
            if (agendamentosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum agendamento encontrado.</td></tr>';
            }
        }
        
        function filtrarAgendamentos() {
            carregarAgendamentos();
        }
        
        function resetFiltroAgenda() {
            document.getElementById('filtro-agenda-data').value = '';
            document.getElementById('filtro-agenda-cliente').value = '';
            carregarAgendamentos();
        }
        
        // =============================================
        // FUNÇÕES PARA PACOTES ATIVOS
        // =============================================
        
        function adicionarPacote(pacoteData) {
            // Gerar ID único
            const id = 'pacote_' + Date.now();
            pacoteData.id = id;
            
            // Adicionar à lista
            pacotesAtivos.push(pacoteData);
            
            // Atualizar interface
            carregarPacotesAtivos();
            
            // Limpar formulário
            document.getElementById('pacote-inicio-form').reset();
            
            // Restaurar data padrão
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('pacote-data-inicio').value = hoje;
            
            // Mostrar notificação
            mostrarNotificacao('Pacote iniciado com sucesso!', 'success');
        }
        
        function usarPacote(pacoteId, usoPacoteData) {
            // Encontrar o pacote
            const pacoteIndex = pacotesAtivos.findIndex(p => p.id === pacoteId);
            
            if (pacoteIndex !== -1) {
                const pacote = pacotesAtivos[pacoteIndex];
                
                // Verificar se ainda há sessões disponíveis
                if (pacote.sessoesUsadas < pacote.sessoesTotal) {
                    // Incrementar sessões usadas
                    pacotesAtivos[pacoteIndex].sessoesUsadas += 1;
                    
                    // Se todas as sessões foram usadas, marcar como finalizado
                    if (pacotesAtivos[pacoteIndex].sessoesUsadas >= pacotesAtivos[pacoteIndex].sessoesTotal) {
                        pacotesAtivos[pacoteIndex].status = 'finalizado';
                    }
                    
                    // Adicionar ao histórico com valor zero (já foi pago no pacote)
                    historico.push(usoPacoteData);
                    
                    // Atualizar interfaces
                    carregarPacotesAtivos();
                    carregarHistorico();
                    renderizarVisaoDiaria();
                    
                    // Fechar modal
                    fecharModalUsarPacote();
                    
                    // Mostrar notificação
                    mostrarNotificacao('Uso do pacote registrado com sucesso!', 'success');
                } else {
                    mostrarNotificacao('Este pacote já foi totalmente utilizado!', 'error');
                }
            }
        }
        
        function marcarPacotePago(id) {
            // Encontrar o pacote
            const pacoteIndex = pacotesAtivos.findIndex(p => p.id === id);
            
            if (pacoteIndex !== -1) {
                // Marcar como pago
                pacotesAtivos[pacoteIndex].pagamento = 'pago';
                
                // Adicionar ao histórico com o valor total do pacote
                const pacote = pacotesAtivos[pacoteIndex];
                const servico = servicos.find(s => s.id === pacote.servicoId);
                
                if (servico) {
                    const historicoItem = {
                        id: 'historico_pacote_' + Date.now(),
                        clienteId: pacote.clienteId,
                        servicoId: pacote.servicoId,
                        data: pacote.dataInicio,
                        valor: servico.preco,
                        status: 'pago',
                        tipo: 'pacote',
                        pacoteId: pacote.id
                    };
                    
                    historico.push(historicoItem);
                }
                
                // Atualizar interfaces
                carregarPacotesAtivos();
                carregarHistorico();
                
                // Mostrar notificação
                mostrarNotificacao('Pacote marcado como pago!', 'success');
            }
        }
        
        function excluirPacote(id) {
            if (confirm('Tem certeza que deseja excluir este pacote?')) {
                // Remover da lista
                pacotesAtivos = pacotesAtivos.filter(p => p.id !== id);
                
                // Atualizar interface
                carregarPacotesAtivos();
                
                // Mostrar notificação
                mostrarNotificacao('Pacote excluído com sucesso!', 'success');
            }
        }
        
        function abrirModalUsarPacote(pacoteId, servicoId, clienteId) {
            // Preencher dados no modal
            document.getElementById('modal-pacote-id').value = pacoteId;
            document.getElementById('modal-pacote-servico-id').value = servicoId;
            document.getElementById('modal-pacote-cliente-id').value = clienteId;
            
            // Configurar data e hora padrão
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('modal-pacote-data').value = hoje;
            document.getElementById('modal-pacote-hora').value = '09:00';
            document.getElementById('modal-pacote-hora-fim').value = '10:00';
            
            // Mostrar modal
            document.getElementById('modal-usar-pacote').style.display = 'flex';
        }
        
        function fecharModalUsarPacote() {
            document.getElementById('modal-usar-pacote').style.display = 'none';
            document.getElementById('form-usar-pacote').reset();
        }
        
        function carregarPacotesAtivos() {
            const tbody = document.getElementById('lista-pacotes-ativos');
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher tabela
            pacotesAtivos.forEach(pacote => {
                const cliente = clientes.find(c => c.id === pacote.clienteId);
                const servico = servicos.find(s => s.id === pacote.servicoId);
                
                const tr = document.createElement('tr');
                
                // Adicionar data-label para responsividade
                tr.innerHTML = `
                    <td data-label="Cliente">${cliente ? cliente.nome : 'Cliente não encontrado'}</td>
                    <td data-label="Pacote">${servico ? servico.nome : 'Serviço não encontrado'} (${pacote.sessoesUsadas}/${pacote.sessoesTotal})</td>
                    <td data-label="Pagamento">
                        ${pacote.pagamento === 'pago' ? 
                            '<span class="status-package-paid">Pago</span>' : 
                            '<span class="status-package-pending">Pendente</span>'}
                    </td>
                    <td data-label="Vencimento">${calcularVencimentoPacote(pacote.dataInicio, 30)}</td>
                    <td data-label="Ações" class="action-buttons">
                        ${pacote.sessoesUsadas < pacote.sessoesTotal ? 
                            `<button class="btn-primary" onclick="abrirModalUsarPacote('${pacote.id}', '${pacote.servicoId}', '${pacote.clienteId}')">
                                <span class="material-icons">event_available</span> Usar
                            </button>` : 
                            '<button class="btn-secondary" disabled><span class="material-icons">event_busy</span> Esgotado</button>'
                        }
                        ${pacote.pagamento === 'pendente' ? 
                            `<button class="btn-success" onclick="marcarPacotePago('${pacote.id}')">
                                <span class="material-icons">payments</span> Marcar Pago
                            </button>` : 
                            ''
                        }
                        <button class="btn-danger" onclick="excluirPacote('${pacote.id}')">
                            <span class="material-icons">delete</span> Excluir
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Se não houver pacotes, mostrar mensagem
            if (pacotesAtivos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum pacote ativo encontrado.</td></tr>';
            }
        }
        
        // =============================================
        // FUNÇÕES PARA VISÃO DIÁRIA
        // =============================================
        
        function renderizarVisaoDiaria(hoje = false) {
            const tbody = document.getElementById('lista-visao-diaria');
            let dataSelecionada;
            
            if (hoje) {
                dataSelecionada = new Date().toISOString().split('T')[0];
                document.getElementById('filtro-visao-diaria-data').value = dataSelecionada;
            } else {
                dataSelecionada = document.getElementById('filtro-visao-diaria-data').value;
            }
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Gerar horários das 07:00 às 22:00, de 30 em 30 minutos
            const horarios = [];
            for (let hora = 7; hora <= 22; hora++) {
                for (let minuto = 0; minuto < 60; minuto += 30) {
                    const horaStr = hora.toString().padStart(2, '0');
                    const minutoStr = minuto.toString().padStart(2, '0');
                    horarios.push(`${horaStr}:${minutoStr}`);
                }
            }
            
            // Preencher tabela com horários
            horarios.forEach(horario => {
                const tr = document.createElement('tr');
                
                // Encontrar agendamentos para este horário e data
                const agendamentosNoHorario = agendamentos.filter(a => 
                    a.data === dataSelecionada && 
                    a.hora <= horario && 
                    a.horaFim > horario
                );
                
                // Encontrar usos de pacote para este horário e data
                const historicoNoHorario = historico.filter(h => 
                    h.data === dataSelecionada && 
                    h.hora <= horario && 
                    h.horaFim > horario &&
                    h.tipo === 'pacote'
                );
                
                // Combinar agendamentos e usos de pacote
                const todosAgendamentos = [...agendamentosNoHorario, ...historicoNoHorario];
                
                let conteudoCelula = '';
                
                if (todosAgendamentos.length > 0) {
                    // Mostrar informações do agendamento
                    todosAgendamentos.forEach(agendamento => {
                        const cliente = clientes.find(c => c.id === agendamento.clienteId);
                        const servico = servicos.find(s => s.id === agendamento.servicoId);
                        
                        const tipo = agendamento.tipo === 'pacote' ? 'Pacote' : 'Individual';
                        
                        conteudoCelula += `
                            <div class="agendamento-ocupado">
                                <strong>${cliente ? cliente.nome : 'Cliente'}</strong><br>
                                ${servico ? servico.nome : 'Serviço'} (${tipo})<br>
                                ${agendamento.hora} - ${agendamento.horaFim}
                            </div>
                        `;
                    });
                } else {
                    // Horário livre
                    conteudoCelula = `<div class="agendamento-vago">Horário Livre</div>`;
                }
                
                tr.innerHTML = `
                    <td class="horario-celula">${horario}</td>
                    <td>${conteudoCelula}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        // =============================================
        // FUNÇÕES PARA HISTÓRICO E LUCROS
        // =============================================
        
        function carregarHistorico() {
            const tbody = document.getElementById('lista-historico');
            const filtroMes = document.getElementById('filtro-historico-mes').value;
            
            // Filtrar histórico
            let historicoFiltrado = historico;
            
            if (filtroMes) {
                historicoFiltrado = historico.filter(h => h.data.startsWith(filtroMes));
            }
            
            // Ordenar por data (mais recente primeiro)
            historicoFiltrado.sort((a, b) => new Date(b.data) - new Date(a.data));
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher tabela
            historicoFiltrado.forEach(item => {
                const cliente = clientes.find(c => c.id === item.clienteId);
                const servico = servicos.find(s => s.id === item.servicoId);
                
                const tr = document.createElement('tr');
                
                // Adicionar data-label para responsividade
                tr.innerHTML = `
                    <td data-label="Data">${formatarData(item.data)}</td>
                    <td data-label="Cliente">${cliente ? cliente.nome : 'Cliente não encontrado'}</td>
                    <td data-label="Serviço">${servico ? servico.nome : 'Serviço não encontrado'} ${item.tipo === 'pacote' ? '(Pacote)' : ''}</td>
                    <td data-label="Valor">R$ ${item.valor.toFixed(2)}</td>
                    <td data-label="Status">
                        ${item.status === 'pago' ? 
                            '<span class="status-package-paid">Pago</span>' : 
                            '<span class="status-package-pending">Pendente</span>'}
                    </td>
                    <td data-label="Ações" class="action-buttons">
                        ${item.status === 'pendente' ? 
                            `<button class="btn-success" onclick="marcarComoPago('${item.id}')">
                                <span class="material-icons">payments</span> Marcar Pago
                            </button>` : 
                            ''
                        }
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Se não houver histórico, mostrar mensagem
            if (historicoFiltrado.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum registro encontrado.</td></tr>';
            }
            
            // Atualizar resumo financeiro
            atualizarResumoFinanceiro(historicoFiltrado);
        }
        
        function marcarComoPago(id) {
            // Encontrar o item no histórico
            const itemIndex = historico.findIndex(h => h.id === id);
            
            if (itemIndex !== -1) {
                // Marcar como pago
                historico[itemIndex].status = 'pago';
                
                // Atualizar interface
                carregarHistorico();
                
                // Mostrar notificação
                mostrarNotificacao('Serviço marcado como pago!', 'success');
            }
        }
        
        function atualizarResumoFinanceiro(historicoFiltrado) {
            // Calcular totais
            const totalRecebido = historicoFiltrado
                .filter(item => item.status === 'pago')
                .reduce((total, item) => total + item.valor, 0);
                
            const totalPendente = historicoFiltrado
                .filter(item => item.status === 'pendente')
                .reduce((total, item) => total + item.valor, 0);
                
            const totalMes = totalRecebido + totalPendente;
            
            // Atualizar elementos
            document.getElementById('total-recebido').textContent = `R$ ${totalRecebido.toFixed(2)}`;
            document.getElementById('total-pendente').textContent = `R$ ${totalPendente.toFixed(2)}`;
            document.getElementById('total-mes').textContent = `R$ ${totalMes.toFixed(2)}`;
        }
        
        function resetFiltroHistorico() {
            document.getElementById('filtro-historico-mes').value = '';
            carregarHistorico();
        }
        
        // =============================================
        // FUNÇÕES UTILITÁRIAS
        // =============================================
        
        function formatarData(data) {
            const partes = data.split('-');
            return `${partes[2]}/${partes[1]}/${partes[0]}`;
        }
        
        function calcularVencimentoPacote(dataInicio, diasValidade) {
            const data = new Date(dataInicio);
            data.setDate(data.getDate() + diasValidade);
            return data.toISOString().split('T')[0];
        }
        
        function mostrarNotificacao(mensagem, tipo) {
            const notificationBar = document.getElementById('notification-bar');
            
            // Configurar mensagem e tipo
            notificationBar.textContent = mensagem;
            notificationBar.className = '';
            notificationBar.classList.add(tipo);
            
            // Mostrar notificação
            notificationBar.classList.add('show');
            
            // Esconder após 3 segundos
            setTimeout(() => {
                notificationBar.classList.remove('show');
            }, 3000);
        }
        
        // =============================================
        // EVENT LISTENERS ADICIONAIS
        // =============================================
        
        // Login
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const senha = document.getElementById('loginSenha').value;
            
            // Verificar senha (simulação)
            if (senha === 'tati123') {
                // Esconder login, mostrar app
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                
                // Inicializar Firebase e carregar dados
                initializeFirebase();
                
                // Mostrar notificação
                mostrarNotificacao('Login realizado com sucesso!', 'success');
            } else {
                mostrarNotificacao('Senha incorreta! Tente novamente.', 'error');
            }
        });
        
        // Logout
        document.getElementById('logout-button').addEventListener('click', function() {
            if (confirm('Tem certeza que deseja sair?')) {
                // Esconder app, mostrar login
                document.getElementById('app-container').style.display = 'none';
                document.getElementById('login-container').style.display = 'flex';
                
                // Limpar formulário de login
                document.getElementById('login-form').reset();
                
                // Mostrar notificação
                mostrarNotificacao('Logout realizado com sucesso!', 'success');
            }
        });
        
        // Fechar modal de usar pacote
        document.querySelector('.close-modal').addEventListener('click', fecharModalUsarPacote);
        document.getElementById('cancelar-usar-pacote').addEventListener('click', fecharModalUsarPacote);
        
        // Fechar modal ao clicar fora
        document.getElementById('modal-usar-pacote').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalUsarPacote();
            }
        });
        
        // =============================================
        // INICIALIZAÇÃO AO CARREGAR A PÁGINA
        // =============================================
        
        // Configurar data atual nos campos de data
        window.addEventListener('load', function() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('filtro-historico-mes').value = hoje.substring(0, 7);
        });
    </script>
</body>
</html>

